<!--
doc/src/sgml/ref/copy.sgml
PostgreSQL documentation
-->


<refentry id="SQL-COPY">
 <indexterm zone="sql-copy">
  <primary>COPY</primary>
 </indexterm>

 <refmeta>
  <refentrytitle>COPY</refentrytitle>
  <manvolnum>7</manvolnum>
<!--
  <refmiscinfo>SQL - Language Statements</refmiscinfo>
-->
<refmiscinfo>SQL - 言語</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>COPY</refname>
<!--
  <refpurpose>copy data between a file and a table</refpurpose>
-->
  <refpurpose>ファイルとテーブルの間でデータをコピーする</refpurpose>
 </refnamediv>

 <refsynopsisdiv>
<synopsis>
COPY <replaceable class="parameter">table_name</replaceable> [ ( <replaceable class="parameter">column_name</replaceable> [, ...] ) ]
    FROM { '<replaceable class="parameter">filename</replaceable>' | PROGRAM '<replaceable class="parameter">command</replaceable>' | STDIN }
    [ [ WITH ] ( <replaceable class="parameter">option</replaceable> [, ...] ) ]

COPY { <replaceable class="parameter">table_name</replaceable> [ ( <replaceable class="parameter">column_name</replaceable> [, ...] ) ] | ( <replaceable class="parameter">query</replaceable> ) }
    TO { '<replaceable class="parameter">filename</replaceable>' | PROGRAM '<replaceable class="parameter">command</replaceable>' | STDOUT }
    [ [ WITH ] ( <replaceable class="parameter">option</replaceable> [, ...] ) ]

<!--
<phrase>where <replaceable class="parameter">option</replaceable> can be one of:</phrase>
-->
<phrase>ここで<replaceable class="parameter">option</replaceable>は以下のいずれかです。</phrase>

    FORMAT <replaceable class="parameter">format_name</replaceable>
    OIDS [ <replaceable class="parameter">boolean</replaceable> ]
    FREEZE [ <replaceable class="parameter">boolean</replaceable> ]
    DELIMITER '<replaceable class="parameter">delimiter_character</replaceable>'
    NULL '<replaceable class="parameter">null_string</replaceable>'
    HEADER [ <replaceable class="parameter">boolean</replaceable> ]
    QUOTE '<replaceable class="parameter">quote_character</replaceable>'
    ESCAPE '<replaceable class="parameter">escape_character</replaceable>'
    FORCE_QUOTE { ( <replaceable class="parameter">column_name</replaceable> [, ...] ) | * }
    FORCE_NOT_NULL ( <replaceable class="parameter">column_name</replaceable> [, ...] )
    FORCE_NULL ( <replaceable class="parameter">column_name</replaceable> [, ...] )
    ENCODING '<replaceable class="parameter">encoding_name</replaceable>'
</synopsis>
 </refsynopsisdiv>

 <refsect1>
<!--
  <title>Description</title>
-->
  <title>説明</title>

  <para>
<!--
   <command>COPY</command> moves data between
   <productname>PostgreSQL</productname> tables and standard file-system
   files. <command>COPY TO</command> copies the contents of a table
   <emphasis>to</> a file, while <command>COPY FROM</command> copies
   data <emphasis>from</> a file to a table (appending the data to
   whatever is in the table already).  <command>COPY TO</command>
   can also copy the results of a <command>SELECT</> query.
-->
<command>COPY</command>コマンドは、<productname>PostgreSQL</productname>のテーブルと標準のファイルシステムのファイル間でデータを移動します。 
<command>COPY TO</command>コマンドはテーブルの内容をファイル<emphasis>に</>コピーします。 
また、<command>COPY FROM</command>コマンドは、ファイル<emphasis>から</>テーブルへとデータをコピーします（この時、既にテーブルにあるデータにコピーした内容を追加します）。
また、<command>COPY TO</command>により<command>SELECT</>問い合わせの結果をコピーすることができます。
  </para>

  <para>
<!--
   If a list of columns is specified, <command>COPY</command> will
   only copy the data in the specified columns to or from the file.
   If there are any columns in the table that are not in the column list,
   <command>COPY FROM</command> will insert the default values for
   those columns.
-->
列リストが指定されている場合、<command>COPY</command>は、指定された列のデータのみをファイルからまたはファイルへコピーします。
列リストに含まれていない列がテーブル内にある場合、<command>COPY FROM</command>はそれらの列にデフォルトの値を挿入します。
  </para>

  <para>
<!--
   <command>COPY</command> with a file name instructs the
   <productname>PostgreSQL</productname> server to directly read from
   or write to a file. The file must be accessible by the
   <productname>PostgreSQL</productname> user (the user ID the server
   runs as) and the name must be specified from the viewpoint of the
   server. When <literal>PROGRAM</literal> is specified, the server
   executes the given command and reads from the standard output of the
   program, or writes to the standard input of the program. The command
   must be specified from the viewpoint of the server, and be executable
   by the <productname>PostgreSQL</productname> user.  When
   <literal>STDIN</literal> or <literal>STDOUT</literal> is
   specified, data is transmitted via the connection between the
   client and the server.
-->
ファイル名付きの<command>COPY</command>コマンドは、<productname>PostgreSQL</productname>サーバに対して直接ファイルへの読み書きをするように命じます。
指定したファイルは必ず<productname>PostgreSQL</productname>ユーザ(サーバを実行しているユーザID)からアクセスできる必要があります。
また、ファイル名はサーバから見たように指定されなければなりません。
<literal>PROGRAM</literal>が指定された場合、サーバは指定したコマンドを実行しその標準出力を読み取る、または、プログラムの標準入力に書き出します。
コマンドはサーバからの視点で指定しなければならず、また、<literal>PostgreSQL</>ユーザによって実行できなければなりません。
<literal>STDIN</literal>や<literal>STDOUT</literal>が指定された場合、データはクライアントとサーバ間を流れます。
  </para>
 </refsect1>

 <refsect1>
<!--
  <title>Parameters</title>
-->
  <title>パラメータ</title>

  <variablelist>
   <varlistentry>
    <term><replaceable class="parameter">table_name</replaceable></term>
    <listitem>
     <para>
<!--
      The name (optionally schema-qualified) of an existing table.
-->
既存のテーブルの名前です（スキーマ修飾名も可）。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="parameter">column_name</replaceable></term>
     <listitem>
     <para>
<!--
      An optional list of columns to be copied.  If no column list is
      specified, all columns of the table will be copied.
-->
コピー対象の列リストで、省略可能です。  
列リストが指定されていない場合は、テーブルの全ての列がコピーされます。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="parameter">query</replaceable></term>
    <listitem>
     <para>
<!--
      A <xref linkend="sql-select"> or
      <xref linkend="sql-values"> command
      whose results are to be copied.
      Note that parentheses are required around the query.
-->
指定した<xref linkend="sql-select">コマンドまたは<xref linkend="sql-values">コマンドの結果がコピーされます。
問い合わせを括弧でくくる必要があることに注意してください。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="parameter">filename</replaceable></term>
    <listitem>
     <para>
<!--
      The path name of the input or output file.  An input file name can be
      an absolute or relative path, but an output file name must be an absolute
      path.  Windows users might need to use an <literal>E''</> string and
      double any backslashes used in the path name.
-->
入出力ファイルのパス名です。
入力ファイル名は絶対パスでも相対パスでも記述することができますが、出力ファイル名は絶対パスでなければなりません。
Windowsユーザの場合、<literal>E''</>文字列を使用し、パス名内のバックスラッシュを二重にする必要があるかもしれません。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>PROGRAM</literal></term>
    <listitem>
     <para>
<!--
      A command to execute. In <command>COPY FROM</command>, the input is
      read from standard output of the command, and in <command>COPY TO</>,
      the output is written to the standard input of the command.
-->
実行するコマンドです。
<command>COPY FROM</command>では、入力はコマンドの標準出力から読み取られ、<command>COPY TO</>では、出力はコマンドの標準入力に書き出されます。
     </para>
     <para>
<!--
      Note that the command is invoked by the shell, so if you need to pass
      any arguments to shell command that come from an untrusted source, you
      must be careful to strip or escape any special characters that might
      have a special meaning for the shell. For security reasons, it is best
      to use a fixed command string, or at least avoid passing any user input
      in it.
-->
コマンドはシェルから呼び出されることに注意してください。
このためシェルコマンドに信頼できない入力元からの任意の引数を渡す必要がある場合、シェルにとって特殊な意味を持つかもしれない特殊文字の除去やエスケープを注意深く実施してください、
セキュリティ上の理由のため、固定のコマンド文字列を使用することが最善です。または少なくともユーザからの入力が渡されることを防止してください。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>STDIN</literal></term>
    <listitem>
     <para>
<!--
      Specifies that input comes from the client application.
-->
入力がクライアントアプリケーションからであることを指定します。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>STDOUT</literal></term>
    <listitem>
     <para>
<!--
      Specifies that output goes to the client application.
-->
出力がクライアントアプリケーションへであることを指定します。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="parameter">boolean</replaceable></term>
    <listitem>
     <para>
<!--
      Specifies whether the selected option should be turned on or off.
      You can write <literal>TRUE</literal>, <literal>ON</>, or
      <literal>1</literal> to enable the option, and <literal>FALSE</literal>,
      <literal>OFF</>, or <literal>0</literal> to disable it.  The
      <replaceable class="parameter">boolean</replaceable> value can also
      be omitted, in which case <literal>TRUE</literal> is assumed.
-->
指定のオプションを有効とするか無効とするかを指定します。
オプションを有効にするには、<literal>TRUE</literal>、<literal>ON</>または<literal>1</literal>と、無効にするには<literal>FALSE</literal>、<literal>OFF</>または<literal>0</literal>と記述します。
また<replaceable class="parameter">boolean</replaceable>値は省略可能であり、省略時は<literal>TRUE</literal>とみなされます。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>FORMAT</literal></term>
    <listitem>
     <para>
<!--
      Selects the data format to be read or written:
      <literal>text</>,
      <literal>csv</> (Comma Separated Values),
      or <literal>binary</>.
      The default is <literal>text</>.
-->
読み取りまたは書き込みに使用するデータ形式を選択します。
<literal>text</>、<literal>csv</>（カンマ区切り値）、または<literal>binary</>です。
デフォルトは<literal>text</>です。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>OIDS</literal></term>
    <listitem>
     <para>
<!--
      Specifies copying the OID for each row.  (An error is raised if
      <literal>OIDS</literal> is specified for a table that does not
      have OIDs, or in the case of copying a <replaceable
      class="parameter">query</replaceable>.)
-->
各行のOIDをコピーするよう指定します
（OIDを持たないテーブルに<literal>OIDS</literal>を指定する場合、または、<replaceable class="parameter">query</replaceable>コピーの場合、エラーが発生します）。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>FREEZE</literal></term>
    <listitem>
     <para>
<!--
      Requests copying the data with rows already frozen, just as they
      would be after running the <command>VACUUM FREEZE</> command.
      This is intended as a performance option for initial data loading.
      Rows will be frozen only if the table being loaded has been created
      or truncated in the current subtransaction, there are no cursors
      open and there are no older snapshots held by this transaction.
-->
<command>VACUUM FREEZE</>コマンドを実行した直後の、凍結状態の行を用いたデータコピー処理を要求します。
これは、初期データロード処理用の性能オプションとしての利用を意図しています。
ロード元のテーブルが現在の副トランザクションで作成または切り詰めされ、開いているカーソルは存在せず、またこのトランザクションで保持される古めのスナップショットが存在しない場合のみ、行は凍結されます。
     </para>
     <para>
<!--
      Note that all other sessions will immediately be able to see the data
      once it has been successfully loaded. This violates the normal rules
      of MVCC visibility and users specifying should be aware of the
      potential problems this might cause.
-->
データのロードに成功すると、他のすべてのセッションから即座にデータが参照可能になることに注意してください。
これはMVCC可視性に関する一般的な規則に違反しますので、指定するユーザはこれが引き起こすかもしれない潜在的な問題に注意しなければなりません。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>DELIMITER</literal></term>
    <listitem>
     <para>
<!--
      Specifies the character that separates columns within each row
      (line) of the file.  The default is a tab character in text format,
      a comma in <literal>CSV</> format.
      This must be a single one-byte character.
      This option is not allowed when using <literal>binary</> format.
-->
ファイルの各行内の列を区切る文字を指定します。
テキスト形式でのデフォルトはタブ文字、<literal>CSV</>形式ではカンマです。
これは単一の1バイト文字でなければなりません。
このオプションは<literal>binary</>形式を使用する場合は許されません。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>NULL</literal></term>
    <listitem>
     <para>
<!--
      Specifies the string that represents a null value. The default is
      <literal>\N</literal> (backslash-N) in text format, and an unquoted empty
      string in <literal>CSV</> format. You might prefer an
      empty string even in text format for cases where you don't want to
      distinguish nulls from empty strings.
      This option is not allowed when using <literal>binary</> format.
-->
NULL値を表す文字列を指定します。
デフォルトは、テキスト形式では<literal>\N</literal>（バックスラッシュN）、<literal>CSV</>形式では引用符のない空文字です。
NULL値と空文字列を区別する必要がない場合は、テキスト形式であっても空文字列を使用した方が良いかもしれません。
このオプションは<literal>binary</>形式を使用する場合は許されません。
     </para>

     <note>
      <para>
<!--
       When using <command>COPY FROM</command>, any data item that matches
       this string will be stored as a null value, so you should make
       sure that you use the same string as you used with
       <command>COPY TO</command>.
-->
<command>COPY FROM</command>の場合、この文字列と一致するデータ要素はNULL値として格納されます。
<command>COPY TO</command>実行時に使用した同じ文字列を使用するようにしてください。
      </para>
     </note>

    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>HEADER</literal></term>
    <listitem>
     <para>
<!--
      Specifies that the file contains a header line with the names of each
      column in the file.  On output, the first line contains the column
      names from the table, and on input, the first line is ignored.
      This option is allowed only when using <literal>CSV</> format.
-->
ヘッダ行を含むファイルを指定します。
このファイルには各列の名前が記載されています。
出力では、先頭行にテーブルの列名が入り、入力では先頭行は無視されます。
このオプションは<literal>CSV</>形式を使用する場合にのみ許されます。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>QUOTE</literal></term>
    <listitem>
     <para>
<!--
      Specifies the quoting character to be used when a data value is quoted.
      The default is double-quote.
      This must be a single one-byte character.
      This option is allowed only when using <literal>CSV</> format.
-->
データ値を引用符付けする際に使用される引用符文字を指定します。
デフォルトは二重引用符です。
これは単一の1バイト文字でなければなりません。
このオプションは<literal>CSV</>形式を使用する場合にのみ許されます。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>ESCAPE</literal></term>
    <listitem>
     <para>
<!--
      Specifies the character that should appear before a
      data character that matches the <literal>QUOTE</> value.
      The default is the same as the <literal>QUOTE</> value (so that
      the quoting character is doubled if it appears in the data).
      This must be a single one-byte character.
      This option is allowed only when using <literal>CSV</> format.
-->
データ内の文字が<literal>QUOTE</>の値と一致する場合に、その前に現れなければならない文字を指定します。
デフォルトは<literal>QUOTE</>の値と同じです（このためデータ内に引用符用文字があるときは二つ続けます）。
これは単一の1バイト文字でなければなりません。
このオプションは<literal>CSV</>形式を使用する場合のみ許されます。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>FORCE_QUOTE</></term>
    <listitem>
     <para>
<!--
      Forces quoting to be
      used for all non-<literal>NULL</> values in each specified column.
      <literal>NULL</> output is never quoted. If <literal>*</> is specified,
      non-<literal>NULL</> values will be quoted in all columns.
      This option is allowed only in <command>COPY TO</>, and only when
      using <literal>CSV</> format.
-->
指定された各列内にある全ての非<literal>NULL</>値を強制的に引用符で囲みます。
<literal>NULL</>出力は引用符で囲まれません。
<literal>*</>が指定された場合、非<literal>NULL</>値はすべての列で引用符付けされます。
このオプションは<command>COPY TO</>において、かつ、<literal>CSV</>形式を使用する場合のみ許されます。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>FORCE_NOT_NULL</></term>
    <listitem>
     <para>
<!--
      Do not match the specified columns' values against the null string.
      In the default case where the null string is empty, this means that
      empty values will be read as zero-length strings rather than nulls,
      even when they are not quoted.
      This option is allowed only in <command>COPY FROM</>, and only when
      using <literal>CSV</> format.
-->
指定された列の値をNULL文字列に対して比較しません。
NULL文字列が空であるデフォルトでは、空の値は引用符付けされていなくてもNULLではなく長さが0の文字列として読み取られることを意味します。
このオプションは<command>COPY FROM</>において、かつ、<literal>CSV</>形式を使用する場合のみで許されます。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>FORCE_NULL</></term>
    <listitem>
     <para>
<!--
      Match the specified columns' values against the null string, even
      if it has been quoted, and if a match is found set the value to
      <literal>NULL</>. In the default case where the null string is empty,
      this converts a quoted empty string into NULL.
      This option is allowed only in <command>COPY FROM</>, and only when
      using <literal>CSV</> format.
-->
指定された列の値を、それが引用符付きであったとしても、NULL文字列と比較し、一致した場合は値を<literal>NULL</>にセットします。
NULL文字列が空であるデフォルトでは、引用符付きの空文字列をNULLに変換します。
このオプションは<command>COPY FROM</>で、かつ<literal>CSV</>形式を使用する場合のみ許されます。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>ENCODING</></term>
    <listitem>
     <para>
<!--
      Specifies that the file is encoded in the <replaceable
      class="parameter">encoding_name</replaceable>.  If this option is
      omitted, the current client encoding is used. See the Notes below
      for more details.
-->
ファイルが<replaceable class="parameter">encoding_name</replaceable>で符号化されていることを指定します。
このオプションが省略された場合、現在のクライアント符号化方式が使用されます。
後述の注釈を参照してください。
     </para>
    </listitem>
   </varlistentry>

  </variablelist>
 </refsect1>

 <refsect1>
<!--
  <title>Outputs</title>
-->
  <title>出力</title>

  <para>
<!--
   On successful completion, a <command>COPY</> command returns a command
   tag of the form
-->
正常に完了した場合、<command>COPY</>コマンドは以下の形式のコマンドタグを返します。
<screen>
COPY <replaceable class="parameter">count</replaceable>
</screen>
<!--
   The <replaceable class="parameter">count</replaceable> is the number
   of rows copied.
-->
<replaceable class="parameter">count</replaceable>はコピーされた行数です。
  </para>

  <note>
   <para>
<!--
    <application>psql</> will print this command tag only if the command
    was not <literal>COPY ... TO STDOUT</>, or the
    equivalent <application>psql</> meta-command
    <literal>\copy ... to stdout</>.  This is to prevent confusing the
    command tag with the data that was just printed.
-->
<application>psql</>はコマンドが<literal>COPY ... TO STDOUT</>であった場合、および、それと同等な<application>psql</>のメタコマンド<literal>\copy ... to stdout</>であった場合は、このコマンドタグを表示しません。
これは、コマンドタグが表示されたデータと混同されないようにするためです。
   </para>
  </note>
 </refsect1>

 <refsect1>
<!--
  <title>Notes</title>
-->
   <title>注釈</title>

   <para>
<!--
    <command>COPY</command> can only be used with plain tables, not
    with views.  However, you can write <literal>COPY (SELECT * FROM
    <replaceable class="parameter">viewname</replaceable>) TO ...</literal>.
-->
<command>COPY</command>は通常のテーブルに対してのみ使用することができます。 
ビューに対して使用することはできません。
しかし、<literal>COPY (SELECT * FROM <replaceable class="parameter">viewname</replaceable>) TO ...</literal>と記述することはできます。
   </para>

   <para>
<!--
    <command>COPY</command> only deals with the specific table named;
    it does not copy data to or from child tables.  Thus for example
    <literal>COPY <replaceable class="parameter">table</> TO</literal>
    shows the same data as <literal>SELECT * FROM ONLY <replaceable
    class="parameter">table</></literal>.  But <literal>COPY
    (SELECT * FROM <replaceable class="parameter">table</>) TO ...</literal>
    can be used to dump all of the data in an inheritance hierarchy.
-->
<command>COPY</command>は指定された特定のテーブルのみを扱います。
つまり子テーブルへまたは子テーブルからのデータのコピーは行いません。
したがって例えば、<literal>COPY <replaceable class="parameter">table</> TO</literal>は<literal>SELECT * FROM ONLY <replaceable class="parameter">table</></literal>と同じデータを示します。
しかし<literal>COPY (SELECT * FROM <replaceable class="parameter">table</>) TO ...</literal>を使用して、継承階層内のすべてのデータをダンプすることができます。
   </para>

   <para>
<!--
    You must have select privilege on the table
    whose values are read by <command>COPY TO</command>, and
    insert privilege on the table into which values
    are inserted by <command>COPY FROM</command>.  It is sufficient
    to have column privileges on the column(s) listed in the command.
-->
<command>COPY TO</command>の場合は値を読み込むテーブルに対するSELECT権限が、<command>COPY FROM</command>の場合は値を挿入するテーブルに対するINSERT権限が必要です。
コマンド内で列挙された列に対する列権限があれば十分です。
   </para>

   <para>
<!--
    Files named in a <command>COPY</command> command are read or written
    directly by the server, not by the client application. Therefore,
    they must reside on or be accessible to the database server machine,
    not the client. They must be accessible to and readable or writable
    by the <productname>PostgreSQL</productname> user (the user ID the
    server runs as), not the client. Similarly,
    the command specified with <literal>PROGRAM</literal> is executed directly
    by the server, not by the client application, must be executable by the
    <productname>PostgreSQL</productname> user.
    <command>COPY</command> naming a file or command is only allowed to
    database superusers, since it allows reading or writing any file that the
    server has privileges to access.
-->
<command>COPY</command>コマンドで指定するファイルは、クライアントアプリケーションではなく、サーバが直接読み込み/書き込みを行います。
したがって、それらのファイルは、クライアントではなく、データベースサーバマシン上に存在するか、または、データベースサーバマシンからアクセス可能である必要があります。
さらに、クライアントではなく、<productname>PostgreSQL</productname>ユーザ（サーバを実行しているユーザID）が、アクセス権限と読み書き権限を持っている必要があります。
同様に、<literal>PROGRAM</literal>で指定されたコマンドは、クライアントアプリケーションではなくサーバにより直接実行されるため、<productname>PostgreSQL</productname>ユーザによって実行可能でなければなりません。
ファイル名またはコマンドを指定した<command>COPY</command>の実行は、データベースのスーパーユーザのみに許可されています。このコマンドによって、サーバがアクセス権限を持つ全てのファイルの読み込み、書き込みが可能になってしまうためです。
   </para>

   <para>
<!--
    Do not confuse <command>COPY</command> with the
    <application>psql</application> instruction
    <command><link linkend="APP-PSQL-meta-commands-copy">\copy</link></command>. <command>\copy</command> invokes
    <command>COPY FROM STDIN</command> or <command>COPY TO
    STDOUT</command>, and then fetches/stores the data in a file
    accessible to the <application>psql</application> client. Thus,
    file accessibility and access rights depend on the client rather
    than the server when <command>\copy</command> is used.
-->
<command>COPY</command>を<application>psql</application>の<command><link linkend="APP-PSQL-meta-commands-copy">\copy</link></command>と混同しないでください。
<command>\copy</command>は<command>COPY FROM STDIN</command>や<command>COPY TO STDOUT</command>を呼び出し、<application>psql</application>クライアントからアクセスできるファイルにデータの書き込み/読み込みを行います。
したがって、<command>\copy</command>コマンドでは、ファイルへのアクセスが可能かどうかと、ファイルに対するアクセス権限の有無は、サーバではなくクライアント側に依存します。
   </para>

   <para>
<!--
    It is recommended that the file name used in <command>COPY</command>
    always be specified as an absolute path. This is enforced by the
    server in the case of <command>COPY TO</command>, but for
    <command>COPY FROM</command> you do have the option of reading from
    a file specified by a relative path. The path will be interpreted
    relative to the working directory of the server process (normally
    the cluster's data directory), not the client's working directory.
-->
<command>COPY</command>でファイル名を指定する時は、常に絶対パスで記述することをお勧めします。
<command>COPY TO</command>コマンドの場合はサーバによって絶対パス指定に変更させられますが、<command>COPY FROM</command>コマンドでは相対パスで指定されたファイルを読み込むことも可能となっています。
後者では、クライアントの作業ディレクトリではなく、サーバプロセスの作業ディレクトリ（通常はクラスタのデータディレクトリ）からの相対的なディレクトリとして解釈されます。
   </para>

   <para>
<!--
    Executing a command with <literal>PROGRAM</literal> might be restricted
    by the operating system's access control mechanisms, such as SELinux.
-->
<literal>PROGRAM</literal>を用いたコマンド実行は、SELinuxなどのオペレーティングシステムのアクセス制御機構によって制限されるかもしれません。
   </para>

   <para>
<!--
    <command>COPY FROM</command> will invoke any triggers and check
    constraints on the destination table. However, it will not invoke rules.
-->
<command>COPY FROM</command>は、宛先テーブル上で任意のトリガと検査制約を呼び出しますが、ルールは呼び出しません。
   </para>

   <para>
<!--
    <command>COPY</command> input and output is affected by
    <varname>DateStyle</varname>. To ensure portability to other
    <productname>PostgreSQL</productname> installations that might use
    non-default <varname>DateStyle</varname> settings,
    <varname>DateStyle</varname> should be set to <literal>ISO</> before
    using <command>COPY TO</>.  It is also a good idea to avoid dumping
    data with <varname>IntervalStyle</varname> set to
    <literal>sql_standard</>, because negative interval values might be
    misinterpreted by a server that has a different setting for
    <varname>IntervalStyle</varname>.
-->
<command>COPY</command>の入出力は<varname>DateStyle</varname>の影響を受けます。
デフォルト以外の<varname>DateStyle</varname>が設定された可能性がある<productname>PostgreSQL</productname>インストレーションとの移植を確実に行いたい場合は、<command>COPY</>を使う前に<varname>DateStyle</varname>を<literal>ISO</>に設定しなければなりません。
また、<varname>IntervalStyle</varname>を<literal>sql_standard</>としてデータをダンプすることは避けることを勧めます。
負の時間間隔値が別の<varname>IntervalStyle</varname>設定を持つサーバで誤解釈される可能性があるためです。
   </para>

   <para>
<!--
    Input data is interpreted according to <literal>ENCODING</literal>
    option or the current client encoding, and output data is encoded
    in <literal>ENCODING</literal> or the current client encoding, even
    if the data does not pass through the client but is read from or
    written to a file directly by the server.
-->
たとえデータがクライアント経由ではなくサーバにより直接ファイルから読み書きされるとしても、入力データは<literal>ENCODING</literal>オプションまたは現在のクライアント符号化方式にしたがって解釈され、出力データは<literal>ENCODING</literal>オプションまたは現在のクライアント符号化方式で符号化されます。
   </para>

   <para>
<!--
    <command>COPY</command> stops operation at the first error. This
    should not lead to problems in the event of a <command>COPY
    TO</command>, but the target table will already have received
    earlier rows in a <command>COPY FROM</command>. These rows will not
    be visible or accessible, but they still occupy disk space. This might
    amount to a considerable amount of wasted disk space if the failure
    happened well into a large copy operation. You might wish to invoke
    <command>VACUUM</command> to recover the wasted space.
-->
<command>COPY</command>では、エラーが発生するとすぐに処理を停止します。
<command>COPY TO</command>コマンドの実行では何ら問題ありませんが、<command>COPY FROM</command>の場合は、対象となるテーブルは初めの方の行を既に受け取っています。
これらの行は不可視となり、アクセスすることもできませんが、ディスク領域を占有します。
したがって、大きなコピー処理がかなり進んだ後で失敗した場合には、それなりの量の無駄なディスク領域が使われてしまいます。
この無駄な領域を取り戻すには、<command>VACUUM</command>を行う必要があります。
   </para>

   <para>
<!--
    <literal>FORCE_NULL</> and <literal>FORCE_NOT_NULL</> can be used
    simultaneously on the same column. This results in converting quoted
    null strings to null values and unquoted null strings to empty strings.
-->
<literal>FORCE_NULL</>と<literal>FORCE_NOT_NULL</>は同じ列について同時に使うことができます。
その場合の結果は、引用符付きのNULL文字列をNULL値に変換し、引用符なしのNULL文字列を空文字列に変換します。
   </para>

 </refsect1>

 <refsect1>
<!--
  <title>File Formats</title>
-->
<title>ファイルの形式</title>

  <refsect2>
<!--
   <title>Text Format</title>
-->
   <title>テキスト形式</title>

   <para>
<!--
    When the <literal>text</> format is used,
    the data read or written is a text file with one line per table row.
    Columns in a row are separated by the delimiter character.
    The column values themselves are strings generated by the
    output function, or acceptable to the input function, of each
    attribute's data type.  The specified null string is used in
    place of columns that are null.
    <command>COPY FROM</command> will raise an error if any line of the
    input file contains more or fewer columns than are expected.
    If <literal>OIDS</literal> is specified, the OID is read or written as the first column,
    preceding the user data columns.
-->
<literal>text</>形式を使用する場合、読み書きされるデータはテーブルの1つの行を1行で表したテキストファイルとなります。
行内の列は区切り文字で区切られます。
列の値自体は、その属性のデータ型の出力関数で生成された、または、その入力関数で受け付け可能な文字列です。
値がNULLの列では、代わりに指定されたNULL値を表す文字列が使用されます。
入力ファイルのいずれかの行にある列数が予期された数と違う場合、<command>COPY FROM</command>はエラーを発生します。
<literal>OIDS</literal>が指定された場合、OIDは、ユーザデータの列の前にある、1番目の列として読み書きされます。
   </para>

   <para>
<!--
    End of data can be represented by a single line containing just
    backslash-period (<literal>\.</>).  An end-of-data marker is
    not necessary when reading from a file, since the end of file
    serves perfectly well; it is needed only when copying data to or from
    client applications using pre-3.0 client protocol.
-->
データの終了は、バックスラッシュとピリオド（<literal>\.</>）のみから構成される1行で表されます。
ファイルの終了により同じ動作になるので、ファイルからの読み込みの場合はデータ終了マークは不要です。 
しかし、3.0以前のクライアントプロトコルを使用したクライアントアプリケーションとデータのコピーを行う場合だけは、読み込み、書き込みを問わず、終了マークが必要です。
   </para>

   <para>
<!--
    Backslash characters (<literal>\</>) can be used in the
    <command>COPY</command> data to quote data characters that might
    otherwise be taken as row or column delimiters. In particular, the
    following characters <emphasis>must</> be preceded by a backslash if
    they appear as part of a column value: backslash itself,
    newline, carriage return, and the current delimiter character.
-->
バックスラッシュ文字（<literal>\</>）は、<command>COPY</command>対象データ内で、行や列の区切り文字と判定される可能性があるデータ文字列の引用符付けに使用します。
特に、バックスラッシュ自体、改行、復帰、使用中の区切り文字などの文字が列の値に含まれている場合は、<emphasis>必ず</>前にバックスラッシュを付けなければなりません。

   </para>

   <para>
<!--
    The specified null string is sent by <command>COPY TO</command> without
    adding any backslashes; conversely, <command>COPY FROM</command> matches
    the input against the null string before removing backslashes.  Therefore,
    a null string such as <literal>\N</literal> cannot be confused with
    the actual data value <literal>\N</literal> (which would be represented
    as <literal>\\N</literal>).
-->
指定されたNULL文字列はバックスラッシュを付けずに<command>COPY TO</command>に送られます。
一方、<command>COPY FROM</command>では、バックスラッシュを削除する前にNULL文字列と入力を比較します。
したがって、<literal>\N</literal>といったNULL文字列が実際の<literal>\N</literal>というデータ値と混乱することはあり得ません。
（これは<literal>\\N</literal>として表現されます。）
   </para>

   <para>
<!--
    The following special backslash sequences are recognized by
    <command>COPY FROM</command>:
-->
<command>COPY FROM</command>は、バックスラッシュで始まる次のような文字の並びを識別します。

   <informaltable>
    <tgroup cols="2">
     <thead>
      <row>
<!--
       <entry>Sequence</entry>
       <entry>Represents</entry>
-->
<entry>文字の並び</entry>
<entry>表現</entry>
      </row>
     </thead>

     <tbody>
      <row>
       <entry><literal>\b</></entry>
<!--
       <entry>Backspace (ASCII 8)</entry>
-->
<entry>バックスペース（ASCII 8）</entry>
      </row>
      <row>
       <entry><literal>\f</></entry>
<!--
       <entry>Form feed (ASCII 12)</entry>
-->
<entry>改ページ（ASCII 12）</entry>
      </row>
      <row>
       <entry><literal>\n</></entry>
<!--
       <entry>Newline (ASCII 10)</entry>
-->
<entry>改行（ASCII 10）</entry>
      </row>
      <row>
       <entry><literal>\r</></entry>
<!--
       <entry>Carriage return (ASCII 13)</entry>
-->
<entry>復帰（ASCII 13）</entry>
      </row>
      <row>
       <entry><literal>\t</></entry>
<!--
       <entry>Tab (ASCII 9)</entry>
-->
<entry>タブ（ASCII 9）</entry>
      </row>
      <row>
       <entry><literal>\v</></entry>
<!--
       <entry>Vertical tab (ASCII 11)</entry>
-->
<entry>垂直タブ（ASCII 11）</entry>
      </row>
      <row>
<!--
       <entry><literal>\</><replaceable>digits</></entry>
       <entry>Backslash followed by one to three octal digits specifies
       the character with that numeric code</entry>
-->
       <entry><literal>\</><replaceable>数字</></entry>
<entry>バックスラッシュに続き1から3個の8進数の数字をコード番号として指定すると、そのコード番号が表す文字を指定できます。</entry>
      </row>
      <row>
       <entry><literal>\x</><replaceable>digits</></entry>
<!--
       <entry>Backslash <literal>x</> followed by one or two hex digits specifies
       the character with that numeric code</entry>
-->
<entry>バックスラッシュ、<literal>x</> という並びに続き1から2個の16進数の数字を指定すると、そのコード番号が表す文字を指定できます。</entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>

<!--
    Presently, <command>COPY TO</command> will never emit an octal or
    hex-digits backslash sequence, but it does use the other sequences
    listed above for those control characters.
-->
現在、<command>COPY TO</command>は、バックスラッシュの後ろに8進数や16進数を付けた形式で文字を出力することはありませんが、上記一覧にある制御文字については、バックスラッシュの文字並びを使用します。
   </para>

   <para>
<!--
    Any other backslashed character that is not mentioned in the above table
    will be taken to represent itself.  However, beware of adding backslashes
    unnecessarily, since that might accidentally produce a string matching the
    end-of-data marker (<literal>\.</>) or the null string (<literal>\N</> by
    default).  These strings will be recognized before any other backslash
    processing is done.
-->
上表で記載されていないバックスラッシュ付きの文字はすべて、その文字自体として解釈されます。
しかし、不要なバックスラッシュの追加には注意してください。
偶然にデータの終わりを示す印（<literal>\.</>）やヌル文字列（デフォルトでは<literal>\N</>）と合致する文字列を生成してしまうかもしれないためです。
これらの文字列は他のバックスラッシュの処理を行う前に解釈されます。
   </para>

   <para>
<!--
    It is strongly recommended that applications generating <command>COPY</command> data convert
    data newlines and carriage returns to the <literal>\n</> and
    <literal>\r</> sequences respectively.  At present it is
    possible to represent a data carriage return by a backslash and carriage
    return, and to represent a data newline by a backslash and newline.
    However, these representations might not be accepted in future releases.
    They are also highly vulnerable to corruption if the <command>COPY</command> file is
    transferred across different machines (for example, from Unix to Windows
    or vice versa).
-->
<command>COPY</command>データを生成するアプリケーションは、データ内の改行と復帰をそれぞれ、<literal>\n</>と<literal>\r</>に変換することを強く推奨されています。
現在のところ、バックスラッシュと復帰文字でデータ内の復帰を表したり、バックスラッシュと改行文字でデータ内の改行を表すことが可能です。
しかし、こういった表現は今後のリリースでは、受け付けられなくなる可能性があります。
また、<command>COPY</command>ファイルが異なるマシンをまたがって転送される場合、破損するおそれがかなりあります
（例えば、UnixからWindowsあるいはその逆）。
   </para>

   <para>
<!--
    <command>COPY TO</command> will terminate each row with a Unix-style
    newline (<quote><literal>\n</></>).  Servers running on Microsoft Windows instead
    output carriage return/newline (<quote><literal>\r\n</></>), but only for
    <command>COPY</> to a server file; for consistency across platforms,
    <command>COPY TO STDOUT</> always sends <quote><literal>\n</></>
    regardless of server platform.
    <command>COPY FROM</command> can handle lines ending with newlines,
    carriage returns, or carriage return/newlines.  To reduce the risk of
    error due to un-backslashed newlines or carriage returns that were
    meant as data, <command>COPY FROM</command> will complain if the line
    endings in the input are not all alike.
-->
<command>COPY TO</command>は各行の行末にUnix形式の改行（<quote><literal>\n</></>）を出力します。
なお、Microsoft Windowsで稼働するサーバの場合は、サーバ上のファイルへの<command>COPY</>の場合にのみ復帰/改行（<quote><literal>\r\n</></>）を出力します。
プラットフォームをまたがる一貫性のために、サーバのプラットフォームにかかわらず、<command>COPY TO STDOUT</>は常に<quote><literal>\n</></>を送信します。
<command>COPY FROM</command>は、改行、復帰、復帰/改行を行末として扱うことができます。
データを意図したバックスラッシュのない改行や復帰によるエラーの危険性を減らすために、<command>COPY FROM</command>は、入力行の行末が全て共通でない場合に警告を発します。
   </para>
  </refsect2>

  <refsect2>
<!--
   <title>CSV Format</title>
-->
   <title>CSV形式</title>

   <para>
<!--
    This format option is used for importing and exporting the Comma
    Separated Value (<literal>CSV</>) file format used by many other
    programs, such as spreadsheets. Instead of the escaping rules used by
    <productname>PostgreSQL</productname>'s standard text format, it
    produces and recognizes the common CSV escaping mechanism.
-->
この形式オプションは、スプレッドシートなど他の多くのプログラムで使用されるカンマ区切り値（<literal>CSV</>）ファイル形式をインポート、エキスポートするために使用されます。
<productname>PostgreSQL</productname>の標準テキスト形式で使用されるエスケープ規則の代わりに、一般的なCSVのエスケープ機構を生成、認識します。
   </para>

   <para>
<!--
    The values in each record are separated by the <literal>DELIMITER</>
    character. If the value contains the delimiter character, the
    <literal>QUOTE</> character, the <literal>NULL</> string, a carriage
    return, or line feed character, then the whole value is prefixed and
    suffixed by the <literal>QUOTE</> character, and any occurrence
    within the value of a <literal>QUOTE</> character or the
    <literal>ESCAPE</> character is preceded by the escape character.
    You can also use <literal>FORCE_QUOTE</> to force quotes when outputting
    non-<literal>NULL</> values in specific columns.
-->
各レコードの値は<literal>DELIMITER</>文字で区切られます。
区切り文字、<literal>QUOTE</>文字、<literal>NULL</>文字列、復帰、改行文字を含む値の場合、全体の値の前後に<literal>QUOTE</>文字が付与されます。値の中で<literal>QUOTE</>文字や<literal>ESCAPE</>文字が現れる場合、その前にエスケープ用の文字が付与されます。
また、<literal>FORCE_QUOTE</>を使用して、特定列内の非<literal>NULL</>値を出力する時に強制的に引用符を付与することもできます。
   </para>

   <para>
<!--
    The <literal>CSV</> format has no standard way to distinguish a
    <literal>NULL</> value from an empty string.
    <productname>PostgreSQL</>'s <command>COPY</> handles this by quoting.
    A <literal>NULL</> is output as the <literal>NULL</> parameter string
    and is not quoted, while a non-<literal>NULL</> value matching the
    <literal>NULL</> parameter string is quoted.  For example, with the
    default settings, a <literal>NULL</> is written as an unquoted empty
    string, while an empty string data value is written with double quotes
    (<literal>""</>). Reading values follows similar rules. You can
    use <literal>FORCE_NOT_NULL</> to prevent <literal>NULL</> input
    comparisons for specific columns. You can also use
    <literal>FORCE_NULL</> to convert quoted null string data values to
    <literal>NULL</>.
-->
<literal>CSV</>形式には<literal>NULL</>値と空文字列とを区別する標準的な方法はありません。
<productname>PostgreSQL</productname>のCOPYでは引用符によってこれを区別しています。
<literal>NULL</>は<literal>NULL</>パラメータの文字列として出力され、引用符で囲まれません。
一方、<literal>NULL</>パラメータの文字列に一致する非<literal>NULL</>値は引用符で囲まれます。
たとえばデフォルトの設定では、<literal>NULL</>は引用符付けのない空文字列として出力され、空文字列のデータ値は2つの引用符（<literal>""</>）で出力されます。
データの読み込みの際も同様の規則に従います。
<literal>FORCE_NOT_NULL</>を使用して、特定列に対し<literal>NULL</>入力の比較を行わないようにすることもできます。
また<literal>FORCE_NULL</>を使うことで、引用符付きのNULL文字列のデータの値を<literal>NULL</>に変換することもできます。

   </para>

   <para>
<!--
    Because backslash is not a special character in the <literal>CSV</>
    format, <literal>\.</>, the end-of-data marker, could also appear
    as a data value.  To avoid any misinterpretation, a <literal>\.</>
    data value appearing as a lone entry on a line is automatically
    quoted on output, and on input, if quoted, is not interpreted as the
    end-of-data marker.  If you are loading a file created by another
    application that has a single unquoted column and might have a
    value of <literal>\.</>, you might need to quote that value in the
    input file.
-->
<literal>CSV</>形式ではバックスラッシュは特別な文字ではありませんので、データ終端記号<literal>\.</>がデータ値として現れることがあります。
誤った解釈を防ぐために、行内の唯一の項目として<literal>\.</>というデータ値が現れる場合、出力に自動的に引用符が付けられます。
また、入力では引用符で括られた場合データ終端記号として解釈されません。
他のアプリケーションで作成されたファイルをロードしようとする場合、引用符で括られない列が1つあるだけで、それが<literal>\.</>という値を持つ可能性があるなら、入力ファイル内のこうした値を引用符で括る必要があります。
   </para>

   <note>
    <para>
<!--
     In <literal>CSV</> format, all characters are significant. A quoted value
     surrounded by white space, or any characters other than
     <literal>DELIMITER</>, will include those characters. This can cause
     errors if you import data from a system that pads <literal>CSV</>
     lines with white space out to some fixed width. If such a situation
     arises you might need to preprocess the <literal>CSV</> file to remove
     the trailing white space, before importing the data into
     <productname>PostgreSQL</>.
-->
<literal>CSV</>形式では文字はすべて意味を持ちます。
空白文字で括られた引用符付きの値など<literal>DELIMITER</>以外のすべての文字がこうした文字に含まれます。
これにより、固定長にするために<literal>CSV</>の行に空白文字を埋めるシステムから取り出したデータをインポートする時にエラーが発生する可能性があります。
このような状況になった場合、<productname>PostgreSQL</>にデータをインポートする前に、その<literal>CSV</>ファイルから余分な空白を除去する前処理が必要になります。
    </para>
   </note>

   <note>
    <para>
<!--
     CSV format will both recognize and produce CSV files with quoted
     values containing embedded carriage returns and line feeds. Thus
     the files are not strictly one line per table row like text-format
     files.
-->
CSV形式は、復帰文字や改行文字が埋め込まれ引用符で囲まれた値を含むCSVファイルを認識し、生成します。
したがって、このファイルでは、テキスト形式とは異なり、1つのテーブル行が1行で表されているとは限りません。
    </para>
   </note>

   <note>
    <para>
<!--
     Many programs produce strange and occasionally perverse CSV files,
     so the file format is more a convention than a standard. Thus you
     might encounter some files that cannot be imported using this
     mechanism, and <command>COPY</> might produce files that other
     programs cannot process.
-->
奇妙な（時には間違った）CSVファイルを生成するプログラムは多く存在するので、このファイル形式は標準というよりも慣習と言えるものです。
したがって、この機能でインポートできないファイルが存在するかもしれませんし、<command>COPY</>が他のプログラムで処理できないファイルを生成するかもしれません。
    </para>
   </note>

  </refsect2>

  <refsect2>
<!--
   <title>Binary Format</title>
-->
<title>バイナリ形式</title>


   <para>
<!--
    The <literal>binary</literal> format option causes all data to be
    stored/read as binary format rather than as text.  It is
    somewhat faster than the text and <literal>CSV</> formats,
    but a binary-format file is less portable across machine architectures and
    <productname>PostgreSQL</productname> versions.
    Also, the binary format is very data type specific; for example
    it will not work to output binary data from a <type>smallint</> column
    and read it into an <type>integer</> column, even though that would work
    fine in text format.
-->
<literal>binary</literal>形式オプションにより、すべてのデータはテキストではなくバイナリ形式で書き込み/読み取りされるようになります。
テキストや<literal>CSV</>形式よりも多少高速になりますが、バイナリ形式のファイルはマシンアーキテクチャや<productname>PostgreSQL</productname>のバージョンをまたがる移植性が落ちます。
またバイナリ形式はデータ型に非常に依存します。
たとえば、<type>smallint</>列からバイナリデータを出力し、それを<type>integer</>列として読み込むことはできません。同じことをテキスト形式で実行すれば動作するのですが。
   </para>

   <para>
<!--
    The <literal>binary</> file format consists
    of a file header, zero or more tuples containing the row data, and
    a file trailer.  Headers and data are in network byte order.
-->
<literal>binary</>ファイルの形式は、ファイルヘッダ、行データを含む0以上のタプル、ファイルトレーラから構成されます。
ヘッダとデータはネットワークバイトオーダです。
   </para>

   <note>
    <para>
<!--
     <productname>PostgreSQL</productname> releases before 7.4 used a
     different binary file format.
-->
7.4以前のリリースの<productname>PostgreSQL</productname>では異なるバイナリファイル形式を使用していました。
    </para>
   </note>

   <refsect3>
<!--
    <title>File Header</title>
-->
    <title>ファイルヘッダ</title>

    <para>
<!--
     The file header consists of 15 bytes of fixed fields, followed
     by a variable-length header extension area.  The fixed fields are:
-->
ファイルヘッダは15バイトの固定フィールドとその後に続く可変長ヘッダ拡張領域から構成されます。
固定フィールドは以下の通りです。

    <variablelist>
     <varlistentry>
<!--
      <term>Signature</term>
-->
      <term>署名</term>
      <listitem>
       <para>
<!--
11-byte sequence <literal>PGCOPY\n\377\r\n\0</> &mdash; note that the zero byte
is a required part of the signature.  (The signature is designed to allow
easy identification of files that have been munged by a non-8-bit-clean
transfer.  This signature will be changed by end-of-line-translation
filters, dropped zero bytes, dropped high bits, or parity changes.)
-->
<literal>PGCOPY\n\377\r\n\0</>という11バイトの並びです。
この署名の必須部分にNULLバイトが含まれていることに注意してください
（この署名は、8ビットを通過させない転送方式によってファイルが破損した場合、これを容易に識別できるように設計されています。
署名は、改行コード変換やNULLバイトの削除、上位ビット落ち、パリティの変更などによって変化します）。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
<!--
      <term>Flags field</term>
-->
      <term>フラグフィールド</term>
      <listitem>
       <para>
<!--
32-bit integer bit mask to denote important aspects of the file format. Bits
are numbered from 0 (<acronym>LSB</>) to 31 (<acronym>MSB</>).  Note that
this field is stored in network byte order (most significant byte first),
as are all the integer fields used in the file format.  Bits
16-31 are reserved to denote critical file format issues; a reader
should abort if it finds an unexpected bit set in this range. Bits 0-15
are reserved to signal backwards-compatible format issues; a reader
should simply ignore any unexpected bits set in this range. Currently
only one flag bit is defined, and the rest must be zero:
-->
このファイル形式の重要な部分となる32ビット整数のビットマスクです。
ビットには0（<acronym>LSB</>） から31（<acronym>MSB</>）までの番号が付いています。
このフィールドは、このファイル形式で使用される他の全ての整数フィールドも同様、ネットワークバイトオーダ（最上位バイトが最初に現れる）で保存されていることに注意してください。
ファイル形式上の致命的な問題を表すために、16-31ビットは予約されています。
この範囲に想定外のビットが設定されていることが判明した場合、読み込み先は処理を中断しなければなりません。
後方互換における形式の問題を通知するために、0-15ビットは予約されています。
この範囲に想定外のビットが設定されていても、読み込み先は無視すべきです。
現在、1つのビットだけがフラグビットとして定義されており、残りは0でなければなりません。
        <variablelist>
         <varlistentry>
<!--
          <term>Bit 16</term>
-->
          <term>ビット16</term>
          <listitem>
           <para>
<!--
            if 1, OIDs are included in the data; if 0, not
-->
1ならば、OIDがデータに含まれています。
0ならば、含まれていません。
           </para>
          </listitem>
         </varlistentry>
        </variablelist></para>
      </listitem>
     </varlistentry>

     <varlistentry>
<!--
      <term>Header extension area length</term>
-->
      <term>ヘッダ拡張領域長</term>
      <listitem>
       <para>
<!--
32-bit integer, length in bytes of remainder of header, not including self.
Currently, this is zero, and the first tuple follows
immediately.  Future changes to the format might allow additional data
to be present in the header.  A reader should silently skip over any header
extension data it does not know what to do with.
-->
自分自身を除いた、ヘッダの残り部分のバイト長を示す32ビットの整数です。
現在、これは0となっており、すぐ後に最初のタプルが続きます。
今後、ヘッダ内に追加データを格納するような形式の変更があるかもしれません。
読み込み側では、ヘッダ拡張データの扱いがわからない場合、そのデータをスキップしなければなりません。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    </para>

    <para>
<!--
The header extension area is envisioned to contain a sequence of
self-identifying chunks.  The flags field is not intended to tell readers
what is in the extension area.  Specific design of header extension contents
is left for a later release.
-->
ヘッダ拡張領域は、それ自身で認識することができる塊の並びを保持するために用意されています。
フラグフィールドは読み込み先に拡張領域の内容を知らせるものではありません。
ヘッダ拡張内容の個々の設計は今後のリリースのために残してあります。
    </para>

    <para>
<!--
     This design allows for both backwards-compatible header additions (add
     header extension chunks, or set low-order flag bits) and
     non-backwards-compatible changes (set high-order flag bits to signal such
     changes, and add supporting data to the extension area if needed).
-->
この設計によって、後方互換性を維持するヘッダの追加（ヘッダ拡張チャンクの追加や下位フラグビットの設定）と後方互換性のない変更（変更を通知するための高位フラグビットの設定や必要に応じた拡張領域へのサポート情報追加）の両方に対応できます。
    </para>
   </refsect3>

   <refsect3>
<!--
    <title>Tuples</title>
-->
    <title>タプル</title>
    <para>
<!--
Each tuple begins with a 16-bit integer count of the number of fields in the
tuple.  (Presently, all tuples in a table will have the same count, but that
might not always be true.)  Then, repeated for each field in the tuple, there
is a 32-bit length word followed by that many bytes of field data.  (The
length word does not include itself, and can be zero.)  As a special case,
-1 indicates a NULL field value.  No value bytes follow in the NULL case.
-->
全てのタプルはタプル内のフィールド数を表す16ビットの整数から始まります（現時点では、テーブル内の全てのタプルは同一のフィールド数を持つことになっていますが、今後、これは変更される可能性があります）。
その後に、タプル中のそれぞれのフィールドが続きます。これらのフィールドには、先頭にフィールドデータが何バイトあるかを表す32ビット長のワードが付けられています
（このワードが表す長さには自分自身は含まれません。したがって、0になることもあります）。
特殊な値としてNULLフィールドを表す-1が用意されています。
このNULLが指定された場合、値用のバイトはありません。
    </para>

    <para>
<!--
There is no alignment padding or any other extra data between fields.
-->
フィールド間には整列用のパッドやその他の余計なデータはありません。
    </para>

    <para>
<!--
Presently, all data values in a binary-format file are
assumed to be in binary format (format code one).  It is anticipated that a
future extension might add a header field that allows per-column format codes
to be specified.
-->
現在、バイナリ形式のファイル内の全てのデータ値は、バイナリ形式（形式コード1）であると想定されています。
将来の拡張によって、列単位に形式コードを指定するヘッダフィールドが追加される可能性があります。
    </para>

    <para>
<!--
To determine the appropriate binary format for the actual tuple data you
should consult the <productname>PostgreSQL</productname> source, in
particular the <function>*send</> and <function>*recv</> functions for
each column's data type (typically these functions are found in the
<filename>src/backend/utils/adt/</filename> directory of the source
distribution).
-->
実際のタプルデータとして適切なバイナリ形式を決定するためには、<productname>PostgreSQL</productname>のソース、特に各列のデータ型用の<function>*send</> 関数と<function>*recv</>関数（通常はソースの配布物内の<filename>src/backend/utils/adt</filename>ディレクトリにあります）を調べなければなりません。
    </para>

    <para>
<!--
If OIDs are included in the file, the OID field immediately follows the
field-count word.  It is a normal field except that it's not included
in the field-count.  In particular it has a length word &mdash; this will allow
handling of 4-byte vs. 8-byte OIDs without too much pain, and will allow
OIDs to be shown as null if that ever proves desirable.
-->
このファイルにOIDが含まれる場合、OIDフィールドがフィールド数ワードの直後に続きます。
これは、フィールド数に含まれない点を除いて、通常のフィールドです。
特に長さワードがありますが、苦労することなく、4バイトのOIDも8バイトのOIDも扱うことができます。
また、これにより、望ましいと判断されれば、OIDをNULLとして表示することができます。
    </para>
   </refsect3>

   <refsect3>
<!--
    <title>File Trailer</title>
-->
    <title>ファイルトレーラ</title>

    <para>
<!--
     The file trailer consists of a 16-bit integer word containing -1.  This
     is easily distinguished from a tuple's field-count word.
-->
ファイルトレーラは、16ビットの整数ワードで構成され、-1が入っています。
タプルのフィールド数ワードとは、容易に区別できます。
    </para>

    <para>
<!--
     A reader should report an error if a field-count word is neither -1
     nor the expected number of columns.  This provides an extra
     check against somehow getting out of sync with the data.
-->
読み込み側は、フィールドカウントワードが-1でも、想定した列数でもなかった場合はエラーを報告しなければなりません。
これにより、何らかの理由でデータと一致しなかったことを判定する特別な検査を行うことが可能になります。
    </para>
   </refsect3>
  </refsect2>
 </refsect1>

 <refsect1>
<!--
  <title>Examples</title>
-->
  <title>例</title>

  <para>
<!--
   The following example copies a table to the client
   using the vertical bar (<literal>|</literal>) as the field delimiter:
-->
次の例では、フィールド区切り文字として縦棒（<literal>|</literal>）を使用してテーブルをクライアントにコピーします。
<programlisting>
COPY country TO STDOUT (DELIMITER '|');
</programlisting>
  </para>

  <para>
<!--
   To copy data from a file into the <literal>country</> table:
-->
ファイルから<literal>country</>テーブルにデータをコピーします。
<programlisting>
COPY country FROM '/usr1/proj/bray/sql/country_data';
</programlisting>
  </para>

  <para>
<!--
   To copy into a file just the countries whose names start with 'A':
-->
名前が'A'から始まる国のみをファイルにコピーします。
<programlisting>
COPY (SELECT * FROM country WHERE country_name LIKE 'A%') TO '/usr1/proj/bray/sql/a_list_countries.copy';
</programlisting>
  </para>

  <para>
<!--
   To copy into a compressed file, you can pipe the output through an external
   compression program:
-->
圧縮したファイルにコピーするためには、以下のように出力を外部の圧縮プログラムにパイプで渡すことができます。
<programlisting>
COPY country TO PROGRAM 'gzip > /usr1/proj/bray/sql/country_data.gz';
</programlisting>
  </para>

  <para>
<!--
   Here is a sample of data suitable for copying into a table from
   <literal>STDIN</literal>:
-->
これは<literal>STDIN</literal>からテーブルにコピーするのに適したデータの例です。
<programlisting>
AF      AFGHANISTAN
AL      ALBANIA
DZ      ALGERIA
ZM      ZAMBIA
ZW      ZIMBABWE
</programlisting>
<!--
   Note that the white space on each line is actually a tab character.
-->
各行の空白文字は実際にはタブ文字であることに注意してください。
  </para>

  <para>
<!--
   The following is the same data, output in binary format.
   The data is shown after filtering through the
   Unix utility <command>od -c</command>. The table has three columns;
   the first has type <type>char(2)</type>, the second has type <type>text</type>,
   and the third has type <type>integer</type>. All the rows have a null value
   in the third column.
-->
以下は同一のデータをバイナリ形式で出力したものです。
データをUnixユーティリティ<command>od -c</command>を使ってフィルタしたものを示します。
テーブルには3列あり、最初のデータ型は<type>char(2)</type>、2番目は<type>text</type>、3番目は<type>integer</type>です。
全ての行の3列目はNULL値です。
<programlisting>
0000000   P   G   C   O   P   Y  \n 377  \r  \n  \0  \0  \0  \0  \0  \0
0000020  \0  \0  \0  \0 003  \0  \0  \0 002   A   F  \0  \0  \0 013   A
0000040   F   G   H   A   N   I   S   T   A   N 377 377 377 377  \0 003
0000060  \0  \0  \0 002   A   L  \0  \0  \0 007   A   L   B   A   N   I
0000100   A 377 377 377 377  \0 003  \0  \0  \0 002   D   Z  \0  \0  \0
0000120 007   A   L   G   E   R   I   A 377 377 377 377  \0 003  \0  \0
0000140  \0 002   Z   M  \0  \0  \0 006   Z   A   M   B   I   A 377 377
0000160 377 377  \0 003  \0  \0  \0 002   Z   W  \0  \0  \0  \b   Z   I
0000200   M   B   A   B   W   E 377 377 377 377 377 377
</programlisting></para>
 </refsect1>

 <refsect1>
<!--
  <title>Compatibility</title>
-->
  <title>互換性</title>

  <para>
<!--
   There is no <command>COPY</command> statement in the SQL standard.
-->
標準SQLには<command>COPY</command>文はありません。
  </para>

  <para>
<!--
   The following syntax was used before <productname>PostgreSQL</>
   version 9.0 and is still supported:
-->
以下の構文は、<productname>PostgreSQL</>バージョン9.0より前に使用されていたもので、まだサポートされています。

<synopsis>
COPY <replaceable class="parameter">table_name</replaceable> [ ( <replaceable class="parameter">column_name</replaceable> [, ...] ) ]
    FROM { '<replaceable class="parameter">filename</replaceable>' | STDIN }
    [ [ WITH ]
          [ BINARY ]
          [ OIDS ]
          [ DELIMITER [ AS ] '<replaceable class="parameter">delimiter</replaceable>' ]
          [ NULL [ AS ] '<replaceable class="parameter">null string</replaceable>' ]
          [ CSV [ HEADER ]
                [ QUOTE [ AS ] '<replaceable class="parameter">quote</replaceable>' ]
                [ ESCAPE [ AS ] '<replaceable class="parameter">escape</replaceable>' ]
                [ FORCE NOT NULL <replaceable class="parameter">column_name</replaceable> [, ...] ] ] ]

COPY { <replaceable class="parameter">table_name</replaceable> [ ( <replaceable class="parameter">column_name</replaceable> [, ...] ) ] | ( <replaceable class="parameter">query</replaceable> ) }
    TO { '<replaceable class="parameter">filename</replaceable>' | STDOUT }
    [ [ WITH ]
          [ BINARY ]
          [ OIDS ]
          [ DELIMITER [ AS ] '<replaceable class="parameter">delimiter</replaceable>' ]
          [ NULL [ AS ] '<replaceable class="parameter">null string</replaceable>' ]
          [ CSV [ HEADER ]
                [ QUOTE [ AS ] '<replaceable class="parameter">quote</replaceable>' ]
                [ ESCAPE [ AS ] '<replaceable class="parameter">escape</replaceable>' ]
                [ FORCE QUOTE { <replaceable class="parameter">column_name</replaceable> [, ...] | * } ] ] ]
</synopsis>

<!--
   Note that in this syntax, <literal>BINARY</> and <literal>CSV</> are
   treated as independent keywords, not as arguments of a <literal>FORMAT</>
   option.
-->
この構文では、<literal>BINARY</>と<literal>CSV</>が<literal>FORMAT</>オプションの引数ではなく、独立したキーワードとして扱われることに注意してください。
  </para>

  <para>
<!--
   The following syntax was used before <productname>PostgreSQL</>
   version 7.3 and is still supported:
-->
以下の構文は、<productname>PostgreSQL</>バージョン7.3より前に使用されていたもので、まだサポートされています。

<synopsis>
COPY [ BINARY ] <replaceable class="parameter">table_name</replaceable> [ WITH OIDS ]
    FROM { '<replaceable class="parameter">filename</replaceable>' | STDIN }
    [ [USING] DELIMITERS '<replaceable class="parameter">delimiter</replaceable>' ]
    [ WITH NULL AS '<replaceable class="parameter">null string</replaceable>' ]

COPY [ BINARY ] <replaceable class="parameter">table_name</replaceable> [ WITH OIDS ]
    TO { '<replaceable class="parameter">filename</replaceable>' | STDOUT }
    [ [USING] DELIMITERS '<replaceable class="parameter">delimiter</replaceable>' ]
    [ WITH NULL AS '<replaceable class="parameter">null string</replaceable>' ]
</synopsis></para>
 </refsect1>
</refentry>
