<!--
doc/src/sgml/ref/insert.sgml
PostgreSQL documentation
-->

<refentry id="SQL-INSERT">
 <indexterm zone="sql-insert">
  <primary>INSERT</primary>
 </indexterm>

 <refmeta>
  <refentrytitle>INSERT</refentrytitle>
  <manvolnum>7</manvolnum>
<!--
  <refmiscinfo>SQL - Language Statements</refmiscinfo>
-->
<refmiscinfo>SQL - 言語</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>INSERT</refname>
<!--
  <refpurpose>create new rows in a table</refpurpose>
-->
  <refpurpose>テーブルに新しい行を作成する</refpurpose>
 </refnamediv>

 <refsynopsisdiv>
<synopsis>
[ WITH [ RECURSIVE ] <replaceable class="parameter">with_query</replaceable> [, ...] ]
INSERT INTO <replaceable class="PARAMETER">table_name</replaceable> [ AS <replaceable class="parameter">alias</replaceable> ] [ ( <replaceable class="PARAMETER">column_name</replaceable> [, ...] ) ]
    { DEFAULT VALUES | VALUES ( { <replaceable class="PARAMETER">expression</replaceable> | DEFAULT } [, ...] ) [, ...] | <replaceable class="PARAMETER">query</replaceable> }
    [ ON CONFLICT [ <replaceable class="parameter">conflict_target</replaceable> ] <replaceable class="parameter">conflict_action</replaceable> ]
    [ RETURNING * | <replaceable class="parameter">output_expression</replaceable> [ [ AS ] <replaceable class="parameter">output_name</replaceable> ] [, ...] ]

<!--
<phrase>where <replaceable class="parameter">conflict_target</replaceable> can be one of:</phrase>
-->
<phrase>ここで<replaceable class="parameter">conflict_target</replaceable>は以下のいずれかです。</phrase>

    ( { <replaceable class="parameter">index_column_name</replaceable> | ( <replaceable class="parameter">index_expression</replaceable> ) } [ COLLATE <replaceable class="parameter">collation</replaceable> ] [ <replaceable class="parameter">opclass</replaceable> ] [, ...] ) [ WHERE <replaceable class="PARAMETER">index_predicate</replaceable> ]
    ON CONSTRAINT <replaceable class="PARAMETER">constraint_name</replaceable>

<!--
<phrase>and <replaceable class="parameter">conflict_action</replaceable> is one of:</phrase>
-->
<phrase>また<replaceable class="parameter">conflict_action</replaceable>は以下のいずれかです。</phrase>

    DO NOTHING
    DO UPDATE SET { <replaceable class="PARAMETER">column_name</replaceable> = { <replaceable class="PARAMETER">expression</replaceable> | DEFAULT } |
                    ( <replaceable class="PARAMETER">column_name</replaceable> [, ...] ) = ( { <replaceable class="PARAMETER">expression</replaceable> | DEFAULT } [, ...] ) |
                    ( <replaceable class="PARAMETER">column_name</replaceable> [, ...] ) = ( <replaceable class="PARAMETER">sub-SELECT</replaceable> )
                  } [, ...]
              [ WHERE <replaceable class="PARAMETER">condition</replaceable> ]
</synopsis>
 </refsynopsisdiv>

 <refsect1>
<!--
  <title>Description</title>
-->
  <title>説明</title>

  <para>
<!--
   <command>INSERT</command> inserts new rows into a table.
   One can insert one or more rows specified by value expressions,
   or zero or more rows resulting from a query.
-->
<command>INSERT</command>はテーブルに新しい行を挿入します。
値式を使用して行（複数可）を挿入すること、および、問い合わせの結果を使って0行以上の行を挿入することができます。
  </para>

  <para>
<!--
   The target column names can be listed in any order.  If no list of
   column names is given at all, the default is all the columns of the
   table in their declared order; or the first <replaceable>N</> column
   names, if there are only <replaceable>N</> columns supplied by the
   <literal>VALUES</> clause or <replaceable>query</>.  The values
   supplied by the <literal>VALUES</> clause or <replaceable>query</> are
   associated with the explicit or implicit column list left-to-right.
-->
対象の列名はどのような順番でも指定できます。
列名リストが指定されなかった場合は、テーブル内の全ての列を宣言時の順番に並べたものがデフォルトとして使われます。
また、<literal>VALUES</>句や<replaceable>query</>で<replaceable>N</>列のみが与えられた場合は、先頭の<replaceable>N</>列の名前が指定されたものとみなされます。
<literal>VALUES</>句や<replaceable>query</>で提供される値は、明示的または暗黙的な列リストと左から右への順で関連付けられます
  </para>

  <para>
<!--
   Each column not present in the explicit or implicit column list will be
   filled with a default value, either its declared default value
   or null if there is none.
-->
明示的または暗黙的な列リストにない各列にはデフォルト値（デフォルト値が宣言されていればその値、未宣言ならばNULL）が挿入されます。
  </para>

  <para>
<!--
   If the expression for any column is not of the correct data type,
   automatic type conversion will be attempted.
-->
各列の式が正しいデータ型でない場合は、自動的に型の変換が行われます。
  </para>

  <para>
<!--
   <literal>ON CONFLICT</> can be used to specify an alternative
   action to raising a unique constraint or exclusion constraint
   violation error. (See <xref linkend="sql-on-conflict"
   endterm="sql-on-conflict-title"> below.)
-->
<literal>ON CONFLICT</>は一意制約または排他制約について、違反のエラーを発生さ>せるのに代わる動作を指定するのに使うことができます。
（以下の<xref linkend="sql-on-conflict" endterm="sql-on-conflict-title">を参照してください。）
  </para>

  <para>
<!--
   The optional <literal>RETURNING</> clause causes <command>INSERT</>
   to compute and return value(s) based on each row actually inserted
   (or updated, if an <literal>ON CONFLICT DO UPDATE</> clause was
   used).  This is primarily useful for obtaining values that were
   supplied by defaults, such as a serial sequence number.  However,
   any expression using the table's columns is allowed.  The syntax of
   the <literal>RETURNING</> list is identical to that of the output
   list of <command>SELECT</>.  Only rows that were successfully
   inserted or updated will be returned.  For example, if a row was
   locked but not updated because an <literal>ON CONFLICT DO UPDATE
   ... WHERE</literal> clause <replaceable
   class="PARAMETER">condition</replaceable> was not satisfied, the
   row will not be returned.
-->
<literal>RETURNING</>句を指定すると、<command>INSERT</>は実際に挿入された（あるいは<literal>ON CONFLICT DO UPDATE</>句によって更新された）各行に基づいて計算された値を返すようになります。
これは、通番のシーケンス番号など、デフォルトで与えられた値を取り出す時に主に便利です。
しかし、そのテーブルの列を使用した任意の式を指定することができます。
<literal>RETURNING</>リストの構文は<command>SELECT</>の出力リストと同一です。
挿入または更新に成功した行だけが返されます。
例えば、行がロックされていて、<literal>ON CONFLICT DO UPDATE ... WHERE</literal>句の <replaceable class="PARAMETER">condition</replaceable>が満たされなかったために更新されなかった行は返されません。
  </para>

  <para>
<!--
   You must have <literal>INSERT</literal> privilege on a table in
   order to insert into it.  If <literal>ON CONFLICT DO UPDATE</> is
   present, <literal>UPDATE</literal> privilege on the table is also
   required.
-->
テーブルに行を追加するには、そのテーブルに対して<literal>INSERT</literal>権限を持っている必要があります。
<literal>ON CONFLICT DO UPDATE</>がある場合は、テーブルの<literal>UPDATE</literal>権限も必要です。
  </para>

  <para>
<!--
   If a column list is specified, you only need
   <literal>INSERT</literal> privilege on the listed columns.
   Similarly, when <literal>ON CONFLICT DO UPDATE</> is specified, you
   only need <literal>UPDATE</> privilege on the column(s) that are
   listed to be updated.  However, <literal>ON CONFLICT DO UPDATE</>
   also requires <literal>SELECT</> privilege on any column whose
   values are read in the <literal>ON CONFLICT DO UPDATE</>
   expressions or <replaceable>condition</>.
-->
列リストを指定する場合は、列挙された列に対する<literal>INSERT</literal>権限のみが必要です。
同様に、<literal>ON CONFLICT DO UPDATE</>が指定されている場合、更新対象として列挙されている列についてのみ、<literal>UPDATE</>権限が必要です。
しかし、<literal>ON CONFLICT DO UPDATE</>はまた、その式あるいは<replaceable>condition</>で読み取られるすべての列についての<literal>SELECT</>権限も必要です。
  </para>

  <para>
<!--
   Use of the <literal>RETURNING</> clause requires <literal>SELECT</>
   privilege on all columns mentioned in <literal>RETURNING</>.
   If you use the <replaceable
   class="PARAMETER">query</replaceable> clause to insert rows from a
   query, you of course need to have <literal>SELECT</literal> privilege on
   any table or column used in the query.
-->
<literal>RETURNING</>句を使用するには、<literal>RETURNING</>で使用するすべての列に対する<literal>SELECT</>権限が必要です。
<replaceable class="PARAMETER">query</replaceable>を使用して問い合わせ結果を元に行を挿入する場合は当然ながら、その問い合わせ内で使われる全てのテーブルまたは列に対して<literal>SELECT</literal>権限を持っている必要があります。
  </para>
 </refsect1>

 <refsect1>
<!--
  <title>Parameters</title>
-->
  <title>パラメータ</title>

  <refsect2 id="SQL-INSERTING-PARAMS">
<!--
   <title id="sql-inserting-params-title">Inserting</title>
-->
   <title id="sql-inserting-params-title">挿入</title>

   <para>
<!--
    This section covers parameters that may be used when only
    inserting new rows.  Parameters <emphasis>exclusively</emphasis>
    used with the <literal>ON CONFLICT</literal> clause are described
    separately.
-->
この節では新しい行を挿入するときにのみ使われるパラメータについて説明します。
<literal>ON CONFLICT</literal>句において<emphasis>のみ</emphasis>使われるパラメータについては、別に説明します。
   </para>

    <variablelist>
     <varlistentry>
      <term><replaceable class="parameter">with_query</replaceable></term>
      <listitem>
       <para>
<!--
        The <literal>WITH</literal> clause allows you to specify one or more
        subqueries that can be referenced by name in the <command>INSERT</>
        query. See <xref linkend="queries-with"> and <xref linkend="sql-select">
        for details.
-->
<literal>WITH</literal>句により、<command>INSERT</>問い合わせ内で名前により参照することができる１つ以上の副問い合わせを指定することができます。
詳しくは<xref linkend="queries-with">と<xref linkend="sql-select">を参照してください。
       </para>
       <para>
<!--
        It is possible for the <replaceable class="parameter">query</replaceable>
        (<command>SELECT</command> statement)
        to also contain a <literal>WITH</literal> clause.  In such a case both
        sets of <replaceable>with_query</replaceable> can be referenced within
        the <replaceable class="parameter">query</replaceable>, but the
        second one takes precedence since it is more closely nested.
-->
<replaceable class="parameter">query</replaceable>（<command>SELECT</command>文）でもまた、<literal>WITH</literal>句を含めることができます。
こうした場合、<replaceable>with_query</replaceable>の集合との両方を<replaceable class="parameter">query</replaceable>内で参照することができます。
しかし、第二の問い合わせがより近くにネストされているため優先します。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="PARAMETER">table_name</replaceable></term>
      <listitem>
       <para>
<!--
        The name (optionally schema-qualified) of an existing table.
-->
既存のテーブルの名前です（スキーマ修飾名も可）。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">alias</replaceable></term>
      <listitem>
       <para>
<!--
        A substitute name for <replaceable
        class="PARAMETER">table_name</replaceable>.  When an alias is
        provided, it completely hides the actual name of the table.
        This is particularly useful when <literal>ON CONFLICT DO
        UPDATE</literal> targets a table named excluded, since that's
        also the name of the special table representing rows proposed
        for insertion.
-->
<replaceable class="PARAMETER">table_name</replaceable>の代替名です。
aliasを指定すると、テーブルの実際の名前が完全に隠されます。
これは、除外対象としたテーブルを<literal>ON CONFLICT DO UPDATE</literal>が対象にしている場合、それが挿入で処理される行を表現する特別なテーブルの名前でもあるため、特に有用となります。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="PARAMETER">column_name</replaceable></term>
      <listitem>
       <para>
<!--
        The name of a column in the table named by <replaceable
        class="PARAMETER">table_name</replaceable>.  The column name
        can be qualified with a subfield name or array subscript, if
        needed.  (Inserting into only some fields of a composite
        column leaves the other fields null.)  When referencing a
        column with <literal>ON CONFLICT DO UPDATE</>, do not include
        the table's name in the specification of a target column.  For
        example, <literal>INSERT ... ON CONFLICT DO UPDATE tab SET
        table_name.col = 1</> is invalid (this follows the general
        behavior for <command>UPDATE</>).
-->
<replaceable class="PARAMETER">table_name</replaceable>で指名されたテーブル内の列名です。
必要なら列名を副フィールドの名前や配列の添え字で修飾することができます。
（複合型の列の一部のフィールドのみを挿入すると他のフィールドはNULLになります。）
<literal>ON CONFLICT DO UPDATE</>で列を参照する場合、対象列の指定にテーブル名を含めてはいけません。
例えば、<literal>INSERT ... ON CONFLICT DO UPDATE tab SET table_name.col = 1</>は無効です（これは<command>UPDATE</>の一般的な動作に従います）。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><literal>DEFAULT VALUES</literal></term>
      <listitem>
       <para>
<!--
        All columns will be filled with their default values.
-->
全ての列に、それぞれのデフォルト値が設定されます。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="PARAMETER">expression</replaceable></term>
      <listitem>
       <para>
<!--
        An expression or value to assign to the corresponding column.
-->
対応する列に代入する式または値を指定します。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><literal>DEFAULT</literal></term>
      <listitem>
       <para>
<!--
        The corresponding column will be filled with
        its default value.
-->
対応する列にデフォルト値を設定します。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="PARAMETER">query</replaceable></term>
      <listitem>
       <para>
<!--
        A query (<command>SELECT</command> statement) that supplies the
        rows to be inserted.  Refer to the
        <xref linkend="sql-select">
        statement for a description of the syntax.
-->
挿入する行を提供する問い合わせ（<command>SELECT</command>文）を指定します。
構文の説明については<xref linkend="sql-select">文を参照してください。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="PARAMETER">output_expression</replaceable></term>
      <listitem>
       <para>
<!--
        An expression to be computed and returned by the
        <command>INSERT</> command after each row is inserted or
        updated. The expression can use any column names of the table
        named by <replaceable
        class="PARAMETER">table_name</replaceable>.  Write
        <literal>*</> to return all columns of the inserted or updated
        row(s).
-->
各行が挿入または更新された後、<command>INSERT</>により計算され、返される式です。
この式には<replaceable class="PARAMETER">table_name</replaceable>で指名されたテーブルの任意の列名を使用することができます。
挿入または更新された行のすべての列を返す場合は<literal>*</>と記載してください。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="PARAMETER">output_name</replaceable></term>
      <listitem>
       <para>
<!--
        A name to use for a returned column.
-->
返される列で使用される名前です。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
  </refsect2>

  <refsect2 id="sql-on-conflict">
   <title id="sql-on-conflict-title"><literal>ON CONFLICT</literal>句</title>
   <indexterm zone="SQL-INSERT">
    <primary>UPSERT</primary>
   </indexterm>
   <indexterm zone="SQL-INSERT">
    <primary>ON CONFLICT</primary>
   </indexterm>
   <para>
<!--
    The optional <literal>ON CONFLICT</literal> clause specifies an
    alternative action to raising a unique violation or exclusion
    constraint violation error.  For each individual row proposed for
    insertion, either the insertion proceeds, or, if an
    <emphasis>arbiter</emphasis> constraint or index specified by
    <parameter>conflict_target</parameter> is violated, the
    alternative <parameter>conflict_action</parameter> is taken.
    <literal>ON CONFLICT DO NOTHING</literal> simply avoids inserting
    a row as its alternative action.  <literal>ON CONFLICT DO
    UPDATE</literal> updates the existing row that conflicts with the
    row proposed for insertion as its alternative action.
-->
オプションの<literal>ON CONFLICT</literal>句では、一意制約や排他制約の違反について、エラーを発生させる代替となる動作を指定します。
挿入しようとされた各行について、挿入の処理が進められるか、あるいは、<parameter>conflict_target</parameter>により指定された<emphasis>競合</emphasis>制約またはインデックスに違反した場合の代替の<parameter>conflict_action</parameter>が実行されるか、のいずれかです。
<literal>ON CONFLICT DO NOTHING</literal>は代替の動作として、単に行の挿入をしなくなるだけです。
<literal>ON CONFLICT DO UPDATE</literal>は代替の動作として、挿入されようとしていた行と競合する既存の行を更新します。
   </para>

   <para>
<!--
    <parameter>conflict_target</parameter> can perform
    <emphasis>unique index inference</emphasis>.  When performing
    inference, it consists of one or more <replaceable
    class="PARAMETER">index_column_name</replaceable> columns and/or
    <replaceable class="PARAMETER">index_expression</replaceable>
    expressions, and an optional <replaceable class="PARAMETER">
    index_predicate</replaceable>.  All <replaceable
    class="PARAMETER">table_name</replaceable> unique indexes that,
    without regard to order, contain exactly the
    <parameter>conflict_target</parameter>-specified
    columns/expressions are inferred (chosen) as arbiter indexes.  If
    an <replaceable class="PARAMETER">index_predicate</replaceable> is
    specified, it must, as a further requirement for inference,
    satisfy arbiter indexes.  Note that this means a non-partial
    unique index (a unique index without a predicate) will be inferred
    (and thus used by <literal>ON CONFLICT</literal>) if such an index
    satisfying every other criteria is available.  If an attempt at
    inference is unsuccessful, an error is raised.
-->
<parameter>conflict_target</parameter>は<emphasis>一意インデックスの推定</emphasis>を実行することができます。
推定を実行するとき、それは1つ以上の<replaceable class="PARAMETER">index_column_name</replaceable>列、または<replaceable class="PARAMETER">index_expression</replaceable>式、あるいはその両方、およびオプションで<replaceable class="PARAMETER"> index_predicate</replaceable>から構成されます。
<replaceable class="PARAMETER">table_name</replaceable>の一意インデックスで<parameter>conflict_target</parameter>で指定された列と式を（順序は関係なく）正確に含むものは、すべて競合解決インデックスとして推定されます（選ばれます）。
<replaceable class="PARAMETER">index_predicate</replaceable>が指定されている場合は、推定のさらなる条件として、それは競合解決インデックスを満たさなければなりません。
これは、部分インデックスでない一意インデックス（述語のない一意インデックス）は、それが他のすべての条件を満たすのであれば推定される（従って<literal>ON CONFLICT</literal>で使用される）ことを意味することに注意して下さい。
推定に失敗した時は、エラーが発生します。
   </para>

   <para>
<!--
    <literal>ON CONFLICT DO UPDATE</literal> guarantees an atomic
    <command>INSERT</command> or <command>UPDATE</command> outcome;
    provided there is no independent error, one of those two outcomes
    is guaranteed, even under high concurrency.  This is also known as
    <firstterm>UPSERT</firstterm> &mdash; <quote>UPDATE or
    INSERT</quote>.
-->
<literal>ON CONFLICT DO UPDATE</literal>は<command>INSERT</command>または<command>UPDATE</command>の原子的な結果を保証します。
無関係のエラーが発生しなければ、多数の同時実行がある状況においてさえも、それら2つの結果のうちの1つになります。
これは<firstterm>UPSERT</firstterm>、つまり<quote>UPDATE or INSERT</quote>としても知られています。
   </para>

    <variablelist>
     <varlistentry>
      <term><replaceable class="parameter">conflict_target</replaceable></term>
      <listitem>
       <para>
<!--
        Specifies which conflicts <literal>ON CONFLICT</literal> takes
        the alternative action on by choosing <firstterm>arbiter
        indexes</firstterm>.  Either performs <emphasis>unique index
        inference</emphasis>, or names a constraint explicitly.  For
        <literal>ON CONFLICT DO NOTHING</literal>, it is optional to
        specify a <parameter>conflict_target</parameter>; when
        omitted, conflicts with all usable constraints (and unique
        indexes) are handled.  For <literal>ON CONFLICT DO
        UPDATE</literal>, a <parameter>conflict_target</parameter>
        <emphasis>must</emphasis> be provided.
-->
<literal>ON CONFLICT</literal>が<firstterm>競合解決インデックス</firstterm>を選ぶことで代替の動作をするときの競合を指定します。
<emphasis>一意インデックスの推定</emphasis>を実行するか、あるいは制約を明示的に指定するかのいずれかです。
<literal>ON CONFLICT DO NOTHING</literal>では<parameter>conflict_target</parameter>を指定するのはオプションです。
省略すると、利用可能なすべての制約（および一意インデックス）との競合が処理されます。
<literal>ON CONFLICT DO UPDATE</literal>では<parameter>conflict_target</parameter>を指定<emphasis>しなければなりません</emphasis>。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">conflict_action</replaceable></term>
      <listitem>
       <para>
<!--
        <parameter>conflict_action</parameter> specifies an
        alternative <literal>ON CONFLICT</literal> action.  It can be
        either <literal>DO NOTHING</literal>, or a <literal>DO
        UPDATE</literal> clause specifying the exact details of the
        <literal>UPDATE</literal> action to be performed in case of a
        conflict.  The <literal>SET</literal> and
        <literal>WHERE</literal> clauses in <literal>ON CONFLICT DO
        UPDATE</literal> have access to the existing row using the
        table's name (or an alias), and to rows proposed for insertion
        using the special <varname>excluded</varname> table.
        <literal>SELECT</> privilege is required on any column in the
        target table where corresponding <varname>excluded</varname>
        columns are read.
-->
<parameter>conflict_action</parameter>では<literal>ON CONFLICT</literal>の代替の動作を指定します。
これは<literal>DO NOTHING</literal>あるいは<literal>DO UPDATE</literal>句のいずれかをとることができ、後者では競合が発生した場合に実行される<literal>UPDATE</literal>の動作の正確な詳細を記述します。
<literal>ON CONFLICT DO UPDATE</literal>の<literal>SET</literal>句と<literal>WHERE</literal>は既存の行にテーブルの名前（または別名）を使ってアクセスでき、また挿入されようとしていた行には、特別な<varname>excluded</varname>テーブルを使ってアクセスできます。
<varname>excluded</varname>の列を読み取るときには、対象テーブルの対応する列の<literal>SELECT</>権限が必要です。
       </para>
       <para>
<!--
        Note that the effects of all per-row <literal>BEFORE
        INSERT</literal> triggers are reflected in
        <varname>excluded</varname> values, since those effects may
        have contributed to the row being excluded from insertion.
-->
すべての行レベルの<literal>BEFORE INSERT</literal>トリガーの結果が<varname>excluded</varname>の値に反映されることに注意して下さい。
これらの結果として、行が挿入から除外されることになったかもしれないからです。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="PARAMETER">index_column_name</replaceable></term>
      <listitem>
       <para>
<!--
        The name of a <replaceable
        class="PARAMETER">table_name</replaceable> column.  Used to
        infer arbiter indexes.  Follows <command>CREATE
        INDEX</command> format.  <literal>SELECT</> privilege on
        <replaceable class="PARAMETER">index_column_name</replaceable>
        is required.
-->
<replaceable class="PARAMETER">table_name</replaceable>の列の名前です。
競合解決インデックスを推定するのに使われます。
<command>CREATE INDEX</command>の形式に従います。
<replaceable class="PARAMETER">index_column_name</replaceable>の<literal>SELECT</>が必要です。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="PARAMETER">index_expression</replaceable></term>
      <listitem>
       <para>
<!--
        Similar to <replaceable
        class="PARAMETER">index_column_name</replaceable>, but used to
        infer expressions on <replaceable
        class="PARAMETER">table_name</replaceable> columns appearing
        within index definitions (not simple columns).  Follows
        <command>CREATE INDEX</command> format.  <literal>SELECT</>
        privilege on any column appearing within <replaceable
        class="PARAMETER">index_expression</replaceable> is required.
-->
<replaceable class="PARAMETER">index_column_name</replaceable>と似ていますが、インデックスの定義に現れる<replaceable class="PARAMETER">table_name</replaceable>の列の式（単純な列ではない）の推定に使われます。
<command>CREATE INDEX</command>の形式に従います。
<replaceable class="PARAMETER">index_expression</replaceable>に現れるすべての列の<literal>SELECT</>権限が必要です。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="PARAMETER">collation</replaceable></term>
      <listitem>
       <para>
<!--
        When specified, mandates that corresponding <replaceable
        class="PARAMETER">index_column_name</replaceable> or
        <replaceable class="PARAMETER">index_expression</replaceable>
        use a particular collation in order to be matched during
        inference.  Typically this is omitted, as collations usually
        do not affect whether or not a constraint violation occurs.
        Follows <command>CREATE INDEX</command> format.
-->
これを指定すると、推定時に、対応する<replaceable class="PARAMETER">index_column_name</replaceable>あるいは<replaceable class="PARAMETER">index_expression</replaceable>をマッチさせるときに、特定の照合順序を指定することになります。
普通は照合順序は制約違反が発生するかどうかに関係しないので、通常は省略されます。
<command>CREATE INDEX</command>の形式に従います。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="PARAMETER">opclass</replaceable></term>
      <listitem>
       <para>
<!--
        When specified, mandates that corresponding <replaceable
        class="PARAMETER">index_column_name</replaceable> or
        <replaceable class="PARAMETER">index_expression</replaceable>
        use particular operator class in order to be matched during
        inference.  Typically this is omitted,  as the
        <emphasis>equality</emphasis> semantics are often equivalent
        across a type's operator classes anyway, or because it's
        sufficient to trust that the defined unique indexes have the
        pertinent definition of equality.  Follows <command>CREATE
        INDEX</command> format.
-->
これを指定すると、推定時に、対応する<replaceable class="PARAMETER">index_column_name</replaceable>あるいは<replaceable class="PARAMETER">index_expression</replaceable>をマッチさせるときに、特定の演算子クラスを指定することになります。
<emphasis>等価</emphasis>の意味は、いずれにせよ、型の演算子クラスをまたがって同等であることが多いですし、また定義された一意インデックスは等価を適切に定義していると信頼すれば十分なので、通常はこれは省略されます。
<command>CREATE INDEX</command>の形式に従います。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="PARAMETER">index_predicate</replaceable></term>
      <listitem>
       <para>
<!--
        Used to allow inference of partial unique indexes.  Any
        indexes that satisfy the predicate (which need not actually be
        partial indexes) can be inferred.  Follows <command>CREATE
        INDEX</command> format.  <literal>SELECT</> privilege on any
        column appearing within <replaceable
        class="PARAMETER">index_predicate</replaceable> is required.
-->
部分一意インデックスの推定を可能にします。
述語を満たすすべてのインデックス（実際に部分インデックスである必要はありません）は推定可能になります。
<command>CREATE INDEX</command>の形式に従います。
<replaceable class="PARAMETER">index_predicate</replaceable>に現れるすべての列について<literal>SELECT</>権限が必要です。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="PARAMETER">constraint_name</replaceable></term>
      <listitem>
       <para>
<!--
        Explicitly specifies an arbiter
        <emphasis>constraint</emphasis> by name, rather than inferring
        a constraint or index.
-->
競合解決の<emphasis>制約</emphasis>を制約やインデックスの推定によるのではなく、明示的に名前で指定します。
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="PARAMETER">condition</replaceable></term>
      <listitem>
       <para>
<!--
        An expression that returns a value of type
        <type>boolean</type>.  Only rows for which this expression
        returns <literal>true</literal> will be updated, although all
        rows will be locked when the <literal>ON CONFLICT DO UPDATE</>
        action is taken.  Note that
        <replaceable>condition</replaceable> is evaluated last, after
        a conflict has been identified as a candidate to update.
-->
<type>boolean</type>型の値を返す式です。
この式が<literal>true</literal>を返す行のみが更新されます。
ただし、<literal>ON CONFLICT DO UPDATE</>の動作が行われるときは、すべての行がロックされます。
<replaceable>condition</replaceable>は最後に評価される、競合が更新対象候補として特定された後であることに注意して下さい。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   <para>
<!--
    Note that exclusion constraints are not supported as arbiters with
    <literal>ON CONFLICT DO UPDATE</literal>. In all cases, only
    <literal>NOT DEFERRABLE</literal> constraints and unique indexes
    are supported as arbiters.
-->
除外制約は<literal>ON CONFLICT DO UPDATE</literal>の競合解決としてはサポートされないことに注意して下さい。
すべての場合について、<literal>NOT DEFERRABLE</literal>である制約と一意インデックスのみが競合解決としてサポートされます。
   </para>

   <para>
<!--
    <command>INSERT</command> with an <literal>ON CONFLICT DO UPDATE</>
    clause is a <quote>deterministic</quote> statement.  This means
    that the command will not be allowed to affect any single existing
    row more than once; a cardinality violation error will be raised
    when this situation arises.  Rows proposed for insertion should
    not duplicate each other in terms of attributes constrained by an
    arbiter index or constraint.
-->
<literal>ON CONFLICT DO UPDATE</>句のある<command>INSERT</command>は<quote>決定論的な</quote>文です。
これは、そのコマンドが既存のどの行に対しても、2回以上影響を与えることが許されない、ということを意味します。
これに反する状況が発生した時は、カーディナリティ違反のエラーが発生します。
挿入されようとする行は、競合解決インデックスあるいは制約により制限される属性の観点で、複製されてはなりません。
   </para>
   <tip>
    <para>
<!--
     It is often preferable to use unique index inference rather than
     naming a constraint directly using <literal>ON CONFLICT ON
     CONSTRAINT</literal> <replaceable class="PARAMETER">
     constraint_name</replaceable>.  Inference will continue to work
     correctly when the underlying index is replaced by another more
     or less equivalent index in an overlapping way, for example when
     using <literal>CREATE UNIQUE INDEX ...  CONCURRENTLY</literal>
     before dropping the index being replaced.
-->
<literal>ON CONFLICT ON CONSTRAINT</literal> <replaceable class="PARAMETER"> constraint_name</replaceable>を使って制約を直接指定するより、一意インデックスの推定を使う方が望ましいことが多いです。
背景にあるインデックスが、他のほぼ同等のインデックスと重なり合う形で置換されるとき、推定は正しく動作し続けます。
例えば、置換されるインデックスを削除する前に<literal>CREATE UNIQUE INDEX ...  CONCURRENTLY</literal>を使う場合です。
    </para>
   </tip>

  </refsect2>
 </refsect1>

 <refsect1>
<!--
  <title>Outputs</title>
-->
  <title>出力</title>

  <para>
<!--
   On successful completion, an <command>INSERT</> command returns a command
   tag of the form
-->
正常に終了すると、<command>INSERT</>は以下のようなコマンドタグを返します。
<screen>
INSERT <replaceable>oid</replaceable> <replaceable class="parameter">count</replaceable>
</screen>
<!--
   The <replaceable class="parameter">count</replaceable> is the
   number of rows inserted or updated.  If <replaceable
   class="parameter">count</replaceable> is exactly one, and the
   target table has OIDs, then <replaceable
   class="parameter">oid</replaceable> is the <acronym>OID</acronym>
   assigned to the inserted row.  The single row must have been
   inserted rather than updated.  Otherwise <replaceable
   class="parameter">oid</replaceable> is zero.
-->
<replaceable class="parameter">count</replaceable>は挿入または更新された行数です。
<replaceable class="parameter">count</replaceable>が正確に1であり、対象のテーブルがOIDを持つ場合、<replaceable class="parameter">oid</replaceable>は挿入された行に割り当てられた<acronym>OID</acronym>です。
その1行は、更新ではなく挿入された行です。
その他の場合、<replaceable class="parameter">oid</replaceable>は0となります。
  </para>

  <para>
<!--
   If the <command>INSERT</> command contains a <literal>RETURNING</>
   clause, the result will be similar to that of a <command>SELECT</>
   statement containing the columns and values defined in the
   <literal>RETURNING</> list, computed over the row(s) inserted or
   updated by the command.
-->
<command>INSERT</>コマンドが<literal>RETURNING</>句を持つ場合、その結果は、<literal>RETURNING</>リストで定義した列と値を持ち、そのコマンドで挿入または更新された行全体に対して計算を行う<command>SELECT</>文の結果と似たものになるでしょう。
  </para>
 </refsect1>

 <refsect1>
<!--
  <title>Examples</title>
-->
  <title>例</title>

  <para>
<!--
   Insert a single row into table <literal>films</literal>:
-->
<literal>films</literal>テーブルに1行を挿入します。

<programlisting>
INSERT INTO films VALUES
    ('UA502', 'Bananas', 105, '1971-07-13', 'Comedy', '82 minutes');
</programlisting>
  </para>

  <para>
<!--
   In this example, the <literal>len</literal> column is
   omitted and therefore it will have the default value:
-->
次の例では、<literal>len</literal>列を省略しています。
したがって、ここにはデフォルト値が入ります。

<programlisting>
INSERT INTO films (code, title, did, date_prod, kind)
    VALUES ('T_601', 'Yojimbo', 106, '1961-06-16', 'Drama');
</programlisting>
  </para>

  <para>
<!--
   This example uses the <literal>DEFAULT</literal> clause for
   the date columns rather than specifying a value:
-->
次の例では、日付列に対して値を指定する代わりに<literal>DEFAULT</literal>を使用します。

<programlisting>
INSERT INTO films VALUES
    ('UA502', 'Bananas', 105, DEFAULT, 'Comedy', '82 minutes');
INSERT INTO films (code, title, did, date_prod, kind)
    VALUES ('T_601', 'Yojimbo', 106, DEFAULT, 'Drama');
</programlisting>
  </para>

  <para>
<!--
   To insert a row consisting entirely of default values:
-->
全てデフォルト値からなる行を挿入します。

<programlisting>
INSERT INTO films DEFAULT VALUES;
</programlisting>
  </para>

  <para>
<!--
   To insert multiple rows using the multirow <command>VALUES</> syntax:
-->
複数行の<command>VALUES</>構文を使用して複数行を挿入します。

<programlisting>
INSERT INTO films (code, title, did, date_prod, kind) VALUES
    ('B6717', 'Tampopo', 110, '1985-02-10', 'Comedy'),
    ('HG120', 'The Dinner Game', 140, DEFAULT, 'Comedy');
</programlisting>
  </para>

  <para>
<!--
   This example inserts some rows into table
   <literal>films</literal> from a table <literal>tmp_films</literal>
   with the same column layout as <literal>films</literal>:
-->
次の例では、<literal>films</literal>テーブルと同じ列レイアウトを持つ<literal>tmp_films</literal>テーブルから<literal>films</literal>テーブルへいくつか行を挿入します。

<programlisting>
INSERT INTO films SELECT * FROM tmp_films WHERE date_prod &lt; '2004-05-07';
</programlisting>
  </para>

  <para>
<!--
   This example inserts into array columns:
-->
次の例では、配列型の列に挿入します。

<programlisting>
<!--
&055;&055; Create an empty 3x3 gameboard for noughts-and-crosses
-->
-- 三目並べ用の3×3マスのゲーム盤を作成します。
INSERT INTO tictactoe (game, board[1:3][1:3])
    VALUES (1, '{{" "," "," "},{" "," "," "},{" "," "," "}}');
<!--
&#045;&#045; The subscripts in the above example aren't really needed
-->
--上の例の添え字は本当は必要ありません。
INSERT INTO tictactoe (game, board)
    VALUES (2, '{{X," "," "},{" ",O," "},{" ",X," "}}');
</programlisting>
  </para>

  <para>
<!--
   Insert a single row into table <literal>distributors</literal>, returning
   the sequence number generated by the <literal>DEFAULT</literal> clause:
-->
<literal>distributors</literal>テーブルに一行を挿入し、その<literal>DEFAULT</literal>句により生成されたシーケンス番号を返します。

<programlisting>
INSERT INTO distributors (did, dname) VALUES (DEFAULT, 'XYZ Widgets')
   RETURNING did;
</programlisting>
  </para>

  <para>
<!--
   Increment the sales count of the salesperson who manages the
   account for Acme Corporation, and record the whole updated row
   along with current time in a log table:
-->
Acme社の顧客を担当する営業担当者の売り上げ数を増やし、ログテーブルに更新行全体と更新時刻を記録します。
<programlisting>
WITH upd AS (
  UPDATE employees SET sales_count = sales_count + 1 WHERE id =
    (SELECT sales_person FROM accounts WHERE name = 'Acme Corporation')
    RETURNING *
)
INSERT INTO employees_log SELECT *, current_timestamp FROM upd;
</programlisting>
  </para>
  <para>
<!--
   Insert or update new distributors as appropriate.  Assumes a unique
   index has been defined that constrains values appearing in the
   <literal>did</literal> column.  Note that the special
   <varname>excluded</> table is used to reference values originally
   proposed for insertion:
-->
新しい販売店(distributors)を適切に挿入または更新します。
<literal>did</literal>列に現れる値を制限する一意インデックスが定義されているものとします。
元々挿入されようとしていた値を参照するために、特別な<varname>excluded</>テーブルが使用されていることに注意して下さい。
<programlisting>
INSERT INTO distributors (did, dname)
    VALUES (5, 'Gizmo Transglobal'), (6, 'Associated Computing, Inc')
    ON CONFLICT (did) DO UPDATE SET dname = EXCLUDED.dname;
</programlisting>
  </para>
  <para>
<!--
   Insert a distributor, or do nothing for rows proposed for insertion
   when an existing, excluded row (a row with a matching constrained
   column or columns after before row insert triggers fire) exists.
   Example assumes a unique index has been defined that constrains
   values appearing in the <literal>did</literal> column:
-->
販売店を挿入するか、あるいは挿入しようとした行について既存の除外行（before insertの行トリガを実行した後で制約列にマッチした行）がある場合は何もしません。
例では<literal>did</literal>列に現れる値を制限する一意インデックスがあるものとしています。
<programlisting>
INSERT INTO distributors (did, dname) VALUES (7, 'Redline GmbH')
    ON CONFLICT (did) DO NOTHING;
</programlisting>
  </para>
  <para>
<!--
   Insert or update new distributors as appropriate.  Example assumes
   a unique index has been defined that constrains values appearing in
   the <literal>did</literal> column.  <literal>WHERE</> clause is
   used to limit the rows actually updated (any existing row not
   updated will still be locked, though):
-->
新しい販売店を適切に挿入または更新します。
例では<literal>did</literal>列に現れる値を制限する一意インデックスがあるものとしています。
実際に更新される行を制限するために<literal>WHERE</>句が使われています（ただし、更新されない既存の行もすべてロックされます）。
<programlisting>
<!--
&#045;- Don't update existing distributors based in a certain ZIP code
-->
-- 特定の郵便番号については既存の販売店を更新しません
INSERT INTO distributors AS d (did, dname) VALUES (8, 'Anvil Distribution')
    ON CONFLICT (did) DO UPDATE
    SET dname = EXCLUDED.dname || ' (formerly ' || d.dname || ')'
    WHERE d.zipcode &lt;&gt; '21201';

<!--
&#045;- Name a constraint directly in the statement (uses associated
&#045;- index to arbitrate taking the DO NOTHING action)
-->
-- 文中で制約を直接指定します（DO NOTHINGの動作をする競合解決のため
-- 関連するインデックスを指定します）
INSERT INTO distributors (did, dname) VALUES (9, 'Antwerp Design')
    ON CONFLICT ON CONSTRAINT distributors_pkey DO NOTHING;
</programlisting>
  </para>
  <para>
<!--
   Insert new distributor if possible;  otherwise
   <literal>DO NOTHING</literal>.  Example assumes a unique index has been
   defined that constrains values appearing in the
   <literal>did</literal> column on a subset of rows where the
   <literal>is_active</literal> Boolean column evaluates to
   <literal>true</literal>:
-->
可能であれば新しい販売店を挿入しますが、できないときは<literal>DO NOTHING</literal>とします。
この例では、<literal>is_active</literal>というブーリアン列が<literal>true</literal>である行という条件で、<literal>did</literal>列に一意インデックスが定義されているものとしています。
<programlisting>
<!--
&#045;- This statement could infer a partial unique index on "did"
&#045;- with a predicate of "WHERE is_active", but it could also
&#045;- just use a regular unique constraint on "did"
-->
-- この文は"WHERE is_active"という述語を使って、部分インデックスを
-- 推定できますが、単に"did"上の通常の一意制約を使うこともできます
INSERT INTO distributors (did, dname) VALUES (10, 'Conrad International')
    ON CONFLICT (did) WHERE is_active DO NOTHING;
</programlisting>
  </para>
 </refsect1>

 <refsect1>
<!--
  <title>Compatibility</title>
-->
  <title>
互換性
  </title>

  <para>
<!--
   <command>INSERT</command> conforms to the SQL standard, except that
   the <literal>RETURNING</> clause is a
   <productname>PostgreSQL</productname> extension, as is the ability
   to use <literal>WITH</> with <command>INSERT</>, and the ability to
   specify an alternative action with <literal>ON CONFLICT</>.
   Also, the case in
   which a column name list is omitted, but not all the columns are
   filled from the <literal>VALUES</> clause or <replaceable>query</>,
   is disallowed by the standard.
-->
<command>INSERT</command>は標準SQLに準拠します。
ただし、<literal>RETURNING</>句、<command>INSERT</>で<literal>WITH</>が可能であること、<literal>ON CONFLICT</>で代替の動作を指定できることは<productname>PostgreSQL</productname>の拡張です。
また、標準SQLでは、列名リストが省略された時に、<literal>VALUES</>句または<replaceable>query</>で一部の列のみを指定することはできません。
  </para>

  <para>
<!--
   Possible limitations of the <replaceable
   class="PARAMETER">query</replaceable> clause are documented under
   <xref linkend="sql-select">.
-->
<replaceable class="PARAMETER">query</replaceable>句の制限については、<xref linkend="sql-select">にて記述されています。
  </para>
 </refsect1>
</refentry>
